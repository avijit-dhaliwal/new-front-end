(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5993],{633:(e,t,s)=>{"use strict";s.d(t,{T5:()=>r.T5,hP:()=>a.hP,kX:()=>r.kX,nO:()=>r.nO,wV:()=>a.wV,yC:()=>n}),s(24763);var a=s(85016),r=s(57424);function n(e,t,s){let r=t.path||(null==s?void 0:s.path);return"path"===(t.routing||(null==s?void 0:s.routing)||"path")?r?{...s,...t,routing:"path"}:a.sb.throw((0,a.kd)(e)):t.path?a.sb.throw((0,a.s7)(e)):{...s,...t,path:void 0}}},919:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2449:(e,t,s)=>{Promise.resolve().then(s.bind(s,67434))},9582:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},19268:(e,t,s)=>{e.exports=s(44637)},20063:(e,t,s)=>{"use strict";var a=s(47260);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}}),s.o(a,"useSelectedLayoutSegments")&&s.d(t,{useSelectedLayoutSegments:function(){return a.useSelectedLayoutSegments}})},23947:(e,t,s)=>{"use strict";s.d(t,{X:()=>r});let a="org_37JO6LPOv2TszfyTF11ra3t6aI6".split(",").map(e=>e.trim()).filter(Boolean),r=e=>!!e&&a.includes(e)},26983:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},44637:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useRouter",{enumerable:!0,get:function(){return n}});let a=s(12115),r=s(79862);function n(){return(0,a.useContext)(r.RouterContext)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},45105:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(12115),r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(e,t)=>{let s=(0,a.forwardRef)((s,n)=>{let{color:l="currentColor",size:i=24,strokeWidth:d=2,absoluteStrokeWidth:c,className:o="",children:x,...m}=s;return(0,a.createElement)("svg",{ref:n,...r,width:i,height:i,stroke:l,strokeWidth:c?24*Number(d)/Number(i):d,className:["lucide","lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()),o].join(" "),...m},[...t.map(e=>{let[t,s]=e;return(0,a.createElement)(t,s)}),...Array.isArray(x)?x:[x]])});return s.displayName="".concat(e),s}},47471:(e,t,s)=>{"use strict";s.d(t,{PromisifiedAuthProvider:()=>d,d:()=>c});var a=s(28014),r=s(633),n=s(19268),l=s(12115);let i=l.createContext(null);function d(e){let{authPromise:t,children:s}=e;return l.createElement(i.Provider,{value:t},s)}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,n.useRouter)(),s=l.useContext(i),d=s;return(s&&"then"in s&&(d=l.use(s)),"undefined"!=typeof window)?(0,a.As)({...d,...e}):t?(0,a.As)(e):(0,r.hP)({...d,...e})}},50906:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]])},67434:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>D});var a=s(95155),r=s(12115),n=s(20063),l=s(28014),i=s(47471),d=s(9582),c=s(89559),o=s(919),x=s(52619),m=s.n(x),u=s(45105);let h=(0,u.A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);var p=s(50906),v=s(26983);let g=(0,u.A)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),f=(0,u.A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);function b(e){return e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e>=1e3?"".concat((e/1e3).toFixed(1),"K"):e.toString()}function j(e){let{clients:t,isLoading:s,error:n}=e,[l,i]=(0,r.useState)(""),[c,o]=(0,r.useState)("all"),x=t.filter(e=>{let t=e.name.toLowerCase().includes(l.toLowerCase()),s="all"===c||"active"===c&&"active"===e.status||"at_risk"===c&&"at_risk"===e.status;return t&&s});return s?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"h-12 bg-[var(--paper-muted)] rounded-xl animate-pulse"}),[1,2,3,4,5].map(e=>(0,a.jsx)("div",{className:"h-20 bg-[var(--paper-muted)] rounded-2xl animate-pulse"},e))]}):n?(0,a.jsxs)("div",{className:"rounded-3xl border border-red-200 dark:border-red-900 bg-red-50 dark:bg-red-900/20 p-8 text-center",children:[(0,a.jsx)(d.A,{className:"mx-auto h-8 w-8 text-red-500 mb-3"}),(0,a.jsx)("p",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:"Failed to load clients"}),(0,a.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:n})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Clients"}),(0,a.jsx)("h2",{className:"mt-2 text-2xl font-display font-semibold text-[var(--ink)]",children:"All Organizations"})]}),(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-[var(--ink-muted)]"}),(0,a.jsx)("input",{type:"text",placeholder:"Search clients...",value:l,onChange:e=>i(e.target.value),className:"pl-9 pr-4 py-2 text-sm rounded-xl border border-[var(--line)] bg-[var(--panel)] text-[var(--ink)] placeholder-[var(--ink-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)] focus:border-transparent w-48 sm:w-64"})]})})]}),(0,a.jsx)("div",{className:"flex gap-2 border-b border-[var(--line)] pb-3",children:["all","active","at_risk"].map(e=>(0,a.jsxs)("button",{onClick:()=>o(e),className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors ".concat(c===e?"bg-[var(--accent-soft)] text-[var(--accent-strong)]":"text-[var(--ink-muted)] hover:bg-[var(--paper-muted)] hover:text-[var(--ink)]"),children:["all"===e?"All":"active"===e?"Active":"At Risk",c===e&&(0,a.jsxs)("span",{className:"ml-2 text-xs",children:["(","all"===e?t.length:x.length,")"]})]},e))}),0===x.length&&(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-12 text-center",children:[(0,a.jsx)(p.A,{className:"mx-auto h-10 w-10 text-[var(--ink-muted)] mb-4"}),(0,a.jsx)("p",{className:"text-sm font-medium text-[var(--ink)]",children:"No clients found"}),(0,a.jsx)("p",{className:"text-xs text-[var(--ink-muted)] mt-1",children:l?"Try adjusting your search":"No clients match the current filter"})]}),(0,a.jsx)("div",{className:"space-y-3",children:x.map(e=>(0,a.jsxs)(m(),{href:"/portal?orgId=".concat(e.id),className:"block rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)] hover:shadow-lg hover:border-[var(--ink-muted)]/30 transition-all duration-200 group",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-[var(--ink)] truncate group-hover:text-[var(--accent-strong)] transition-colors",children:e.name}),function(e){switch(e){case"active":return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-green-100 dark:bg-green-900/30 px-2.5 py-0.5 text-xs font-medium text-green-700 dark:text-green-400",children:[(0,a.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),"Active"]});case"inactive":return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-blue-100 dark:bg-blue-900/30 px-2.5 py-0.5 text-xs font-medium text-blue-700 dark:text-blue-400",children:[(0,a.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-blue-500"}),"Inactive"]});case"at_risk":return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-amber-100 dark:bg-amber-900/30 px-2.5 py-0.5 text-xs font-medium text-amber-700 dark:text-amber-400",children:[(0,a.jsx)(d.A,{className:"h-3 w-3"}),"At Risk"]});case"churned":return(0,a.jsx)("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-gray-100 dark:bg-gray-800 px-2.5 py-0.5 text-xs font-medium text-gray-600 dark:text-gray-400",children:"Churned"})}}(e.status)]}),(0,a.jsxs)("p",{className:"mt-1 text-xs text-[var(--ink-muted)]",children:[e.plan," plan"]})]}),(0,a.jsxs)("div",{className:"hidden sm:flex items-center gap-8",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-[var(--ink-muted)]",children:[(0,a.jsx)(v.A,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{className:"text-xs",children:"Last Activity"})]}),(0,a.jsx)("p",{className:"mt-1 text-sm font-medium text-[var(--ink)]",children:e.lastActivity||"N/A"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-[var(--ink-muted)]",children:[(0,a.jsx)(p.A,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{className:"text-xs",children:"Today"})]}),(0,a.jsxs)("p",{className:"mt-1 text-sm font-medium text-[var(--ink)]",children:[b(e.todaySessions)," sessions"]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-[var(--ink-muted)]",children:[(0,a.jsx)(g,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{className:"text-xs",children:"Sites"})]}),(0,a.jsx)("p",{className:"mt-1 text-sm font-bold text-[var(--ink)]",children:e.siteCount})]})]}),(0,a.jsx)(f,{className:"h-5 w-5 text-[var(--ink-muted)] group-hover:text-[var(--accent-strong)] group-hover:translate-x-1 transition-all"})]}),(0,a.jsxs)("div",{className:"sm:hidden mt-4 grid grid-cols-3 gap-4 pt-4 border-t border-[var(--line)]",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-[var(--ink-muted)]",children:"Last Activity"}),(0,a.jsx)("p",{className:"text-sm font-medium text-[var(--ink)]",children:e.lastActivity||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-[var(--ink-muted)]",children:"Sessions"}),(0,a.jsx)("p",{className:"text-sm font-medium text-[var(--ink)]",children:b(e.todaySessions)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-[var(--ink-muted)]",children:"Sites"}),(0,a.jsx)("p",{className:"text-sm font-bold text-[var(--ink)]",children:e.siteCount})]})]})]},e.id))})]})}let N={success:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300",warning:"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400",critical:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400",info:"bg-[var(--accent-soft)] text-[var(--accent-strong)]",neutral:"bg-[var(--paper-muted)] text-[var(--ink-muted)]"};function k(e){let{label:t,tone:s="neutral"}=e;return(0,a.jsx)("span",{className:"rounded-full px-3 py-1 text-xs font-semibold ".concat(N[s]),children:t})}var w=s(23947);let y=s(87358).env.NEXT_PUBLIC_PORTAL_WORKER_URL||"",A=e=>Number.isFinite(e)?e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e>=1e3?"".concat((e/1e3).toFixed(1),"K"):e.toLocaleString():"--",S=e=>null==e?"--":"$".concat((e/100).toFixed(2));function L(){return(0,a.jsx)("div",{className:"max-w-6xl mx-auto space-y-16 animate-pulse",children:(0,a.jsxs)("section",{className:"pt-10",children:[(0,a.jsx)("div",{className:"h-6 w-24 bg-[var(--paper-muted)] rounded mb-4"}),(0,a.jsx)("div",{className:"h-10 w-96 bg-[var(--paper-muted)] rounded mb-4"}),(0,a.jsx)("div",{className:"h-4 w-72 bg-[var(--paper-muted)] rounded"}),(0,a.jsx)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>(0,a.jsx)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 h-32"},e))})]})})}function _(e){let{message:t,onRetry:s}=e;return(0,a.jsx)("div",{className:"max-w-6xl mx-auto pt-10",children:(0,a.jsxs)("div",{className:"rounded-3xl border border-red-200 dark:border-red-900 bg-red-50 dark:bg-red-900/20 p-8 text-center",children:[(0,a.jsx)(d.A,{className:"mx-auto h-10 w-10 text-red-500 mb-4"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-red-800 dark:text-red-300 mb-2",children:"Failed to load portal data"}),(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400 mb-6",children:t}),(0,a.jsxs)("button",{onClick:s,className:"inline-flex items-center gap-2 rounded-full border border-red-300 dark:border-red-700 bg-white dark:bg-red-900/30 px-4 py-2 text-sm font-medium text-red-700 dark:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/50 transition-colors",children:[(0,a.jsx)(c.A,{className:"h-4 w-4"}),"Try again"]})]})})}function C(e){let{status:t,onManageBilling:s}=e;if(!t||"past_due"!==t&&"unpaid"!==t)return null;let r="past_due"===t;return(0,a.jsx)("div",{className:"rounded-2xl border p-4 mb-6 ".concat(r?"border-amber-200 dark:border-amber-900 bg-amber-50 dark:bg-amber-900/20":"border-red-200 dark:border-red-900 bg-red-50 dark:bg-red-900/20"),children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(d.A,{className:"h-5 w-5 mt-0.5 ".concat(r?"text-amber-500":"text-red-500")}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold ".concat(r?"text-amber-800 dark:text-amber-300":"text-red-800 dark:text-red-300"),children:r?"Payment Past Due":"Payment Required"}),(0,a.jsx)("p",{className:"text-sm mt-1 ".concat(r?"text-amber-700 dark:text-amber-400":"text-red-700 dark:text-red-400"),children:r?"Your subscription payment is past due. Please update your payment method to avoid service interruption.":"Your subscription is unpaid. Please update your payment method to restore full access to your AI services."}),(0,a.jsx)("button",{onClick:s,className:"mt-3 inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-medium transition-colors ".concat(r?"border border-amber-300 dark:border-amber-700 bg-white dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 hover:bg-amber-50 dark:hover:bg-amber-900/50":"border border-red-300 dark:border-red-700 bg-white dark:bg-red-900/30 text-red-700 dark:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/50"),children:"Manage Billing"})]})]})})}function R(){return(0,a.jsx)("div",{className:"max-w-6xl mx-auto pt-10",children:(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-12 text-center shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("div",{className:"mx-auto h-16 w-16 rounded-2xl bg-[var(--accent-soft)] flex items-center justify-center mb-6",children:(0,a.jsx)(o.A,{className:"h-8 w-8 text-[var(--accent)]"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-[var(--ink)] mb-2",children:"Setting up your portal"}),(0,a.jsx)("p",{className:"text-sm text-[var(--ink-muted)] max-w-md mx-auto",children:"Your portal is being configured. Data will appear here once your AI services are active and generating metrics."})]})})}function I(e){var t,s,r;let{data:n,outcomes:l,billing:i,subscriptionStatus:d,onManageBilling:c}=e;return n.metrics.some(e=>{let t=Number(e.value.replace(/[^0-9.]/g,""));return Number.isFinite(t)&&t>0})||n.engines.length>0||n.workflows.length>0||n.flows.length>0||n.flowTests.length>0||n.flowInsights.length>0||n.insights.length>0||n.qualitySignals.length>0||n.knowledge&&(n.knowledge.sources.length>0||n.knowledge.documents.length>0)||n.teamAccess.length>0||n.integrations.length>0||n.outcomes.length>0||n.actionRuns.length>0||n.auditLogs.length>0||n.retentionPolicies.length>0||n.events.length>0||l.length>0||i.length>0?(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-16",children:[(0,a.jsx)("div",{className:"pt-10",children:(0,a.jsx)(C,{status:d,onManageBilling:c})}),(0,a.jsxs)("section",{id:"overview",className:d&&("past_due"===d||"unpaid"===d)?"":"pt-10",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Overview"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Your AI operations, at a glance."}),(0,a.jsx)("p",{className:"mt-3 text-sm text-[var(--ink-muted)]",children:"All metrics are aggregated and anonymized for security."})]}),(0,a.jsx)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-4 py-2 text-xs text-[var(--ink-muted)]",children:"Reporting window: Last 30 days"})]}),(0,a.jsx)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:n.metrics.map(e=>(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:e.label}),(0,a.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.value}),e.change&&(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.change})]},e.label))})]}),n.engines.length>0&&(0,a.jsxs)("section",{id:"operations",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Live Ops"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Core engines status"})]}),(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:n.engines.map(e=>(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-base font-semibold text-[var(--ink)]",children:e.title}),(0,a.jsx)("span",{className:"rounded-full px-3 py-1 text-xs font-semibold ".concat("Healthy"===e.status||"Active"===e.status||"Synced"===e.status?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"Degraded"===e.status?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"),children:e.status})]}),(0,a.jsx)("p",{className:"mt-3 text-sm text-[var(--ink-muted)]",children:e.detail}),(0,a.jsx)("p",{className:"mt-4 text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:e.metric})]},e.title))})]}),n.auditLogs.length>0&&(0,a.jsxs)("section",{id:"audit",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Audit Logs"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Compliance trail"})]}),(0,a.jsx)("div",{className:"mt-6 space-y-3",children:n.auditLogs.slice(0,8).map(e=>(0,a.jsxs)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.eventType}),(0,a.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:new Date(e.createdAt).toLocaleString()})]}),(0,a.jsxs)("p",{className:"mt-1 text-xs text-[var(--ink-muted)]",children:["Actor: ",e.actorType||"system"," ",e.actorId?"(".concat(e.actorId,")"):""]}),e.targetType&&(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Target: ",e.targetType," ",e.targetId||""]})]},e.id))})]}),n.retentionPolicies.length>0&&(0,a.jsxs)("section",{id:"retention",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Retention"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Data lifecycle controls"})]}),(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-3",children:n.retentionPolicies.map(e=>(0,a.jsxs)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.dataType}),(0,a.jsx)(k,{label:"".concat(e.ttlDays," days"),tone:"neutral"})]}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.applyAnonymization?"Anonymize before delete":"Delete on expiry"}),e.enforcedAt&&(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Enforced: ",new Date(e.enforcedAt).toLocaleDateString()]})]},e.id))})]}),n.events.length>0&&(0,a.jsxs)("section",{id:"activity",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Recent Activity"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Latest conversations and actions"})]}),(0,a.jsx)("div",{className:"mt-6 space-y-3",children:n.events.slice(0,15).map(e=>(0,a.jsxs)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-[var(--ink)]",children:function(e){switch(e.type){case"session_started":return"Session started";case"session_ended":return"Session ended";case"user_message":return"Visitor message";case"assistant_message":return"Assistant response";case"lead_captured":return"Lead captured";case"appointment_booked":return"Appointment booked";case"action_run":return"Action run";case"outcome_recorded":return"Outcome recorded";default:return e.type}}(e)}),(0,a.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:"•"}),(0,a.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:new Date(e.created_at).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:e.session_id?"Session ".concat(e.session_id.slice(0,8)):""})]}),e.content&&(0,a.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)] line-clamp-2",children:e.content}),(0,a.jsxs)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:["Site ",e.site_id.slice(0,8)," \xb7 Org ",e.org_id.slice(0,8)]})]},e.id))})]}),(n.flows.length>0||n.workflows.length>0)&&(0,a.jsxs)("section",{id:"automations",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Automations"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Flows powering actions"})]}),n.flowTests.length>0&&(0,a.jsxs)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1 text-xs text-[var(--ink-muted)]",children:[n.flowTests.filter(e=>"passed"===e.last_result).length," / ",n.flowTests.length," tests passing"]})]}),(0,a.jsx)("div",{className:"mt-6 space-y-3",children:(n.flows.length>0?n.flows:n.workflows).map(e=>{var t;let s="status"in e?e.status:"active";return(0,a.jsx)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"name"in e?e.name:"Unnamed flow"}),"description"in e&&e.description&&(0,a.jsx)("p",{className:"text-xs text-[var(--ink-muted)] line-clamp-2",children:e.description}),"lastRun"in e&&e.lastRun&&(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Last run: ",e.lastRun]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["trigger"in e&&(null==(t=e.trigger)?void 0:t.type)&&(0,a.jsx)(k,{label:"Trigger: ".concat(e.trigger.type),tone:"info"}),(0,a.jsx)(k,{label:"Status: ".concat(s),tone:"active"===s?"success":"draft"===s||"paused"===s?"warning":"neutral"})]})]})},e.id||e.name)})}),n.flowTests.length>0&&(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)] mb-4",children:"Flow tests"}),(0,a.jsx)("div",{className:"space-y-3",children:n.flowTests.slice(0,5).map(e=>{let t="passed"===e.last_result?"success":"failed"===e.last_result?"critical":"warning";return(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3 rounded-2xl border border-[var(--line)] bg-[var(--paper)] p-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Expected: ",e.expected_outcome]})]}),(0,a.jsx)(k,{label:e.last_result||"not run",tone:t})]},e.id)})})]}),n.flowInsights.length>0&&(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)] mb-4",children:"Recent flow runs"}),(0,a.jsx)("div",{className:"space-y-3",children:n.flowInsights.slice(0,5).map(e=>{let t="success"===e.outcome?"success":"handoff"===e.outcome?"info":"failed"===e.outcome?"critical":"warning";return(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3 rounded-2xl border border-[var(--line)] bg-[var(--paper)] p-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.flow_id}),(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:[new Date(e.started_at).toLocaleString()," \xb7 ",Math.round(e.duration_ms)," ms"]})]}),(0,a.jsx)(k,{label:e.outcome,tone:t})]},e.run_id)})})]})]}),(0,a.jsxs)("section",{id:"outcomes",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Outcomes"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Proof of impact across inbox, bookings, and revenue"})]}),n.outcomes.length>0?(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:n.outcomes.map(e=>(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.title}),e.change&&(0,a.jsx)("span",{className:"text-xs font-semibold px-2 py-1 rounded-full ".concat("down"===e.status?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300":"flat"===e.status?"bg-[var(--paper-muted)] text-[var(--ink-muted)]":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300"),children:e.change})]}),(0,a.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.value}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.note||e.horizon||"Last 30 days"})]},e.id))}):(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"Outcome tracking coming online"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Once flows are paired with billing, scheduling, and CRM actions, we'll show closed-loop outcomes here—bookings, payments, recoveries, and review wins."})]})]}),(0,a.jsxs)("section",{id:"knowledge",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Knowledge"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Sources, versions, and policy guardrails"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 text-xs text-[var(--ink-muted)]",children:[(0,a.jsxs)("span",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1",children:[(null==(t=n.knowledge)?void 0:t.sources.length)||0," sources"]}),(0,a.jsxs)("span",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1",children:[(null==(s=n.knowledge)?void 0:s.documents.length)||0," documents"]}),(0,a.jsxs)("span",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1",children:[(null==(r=n.knowledge)?void 0:r.policies.length)||0," policies"]})]})]}),n.knowledge&&n.knowledge.sources.length>0?(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:n.knowledge.sources.map(e=>{let t="connected"===e.status?"success":"syncing"===e.status?"warning":"error"===e.status?"critical":"neutral";return(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)] capitalize",children:[e.type," source"]})]}),(0,a.jsx)(k,{label:e.status,tone:t})]}),(0,a.jsx)("p",{className:"mt-3 text-xs text-[var(--ink-muted)]",children:e.last_synced_at?"Last synced ".concat(new Date(e.last_synced_at).toLocaleString()):"Waiting on first sync"}),e.error_message&&(0,a.jsx)("p",{className:"mt-2 text-xs text-red-600",children:e.error_message})]},e.id)})}):(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"No sources connected yet"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Link files, URLs, and apps to ground the assistant. Sync status and errors will show here once Agent 3 plugs in ingestion."})]}),n.knowledge&&n.knowledge.documents.length>0&&(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)] mb-4",children:"Latest documents"}),(0,a.jsx)("div",{className:"space-y-3",children:n.knowledge.documents.slice(0,4).map(e=>{let t="ready"===e.status?"success":"processing"===e.status?"warning":"failed"===e.status?"critical":"neutral";return(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3 rounded-2xl border border-[var(--line)] bg-[var(--paper)] p-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.title}),(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:[e.mime_type||"Unknown type"," \xb7 ",e.size_bytes?"".concat(Math.round(e.size_bytes/1024)," KB"):"Size pending"]})]}),(0,a.jsx)(k,{label:e.status,tone:t})]},e.id)})})]}),n.qualitySignals.length>0&&(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:n.qualitySignals.map(e=>(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.title}),(0,a.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.value}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.note})]},e.title))})]}),(0,a.jsxs)("section",{id:"integrations",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Integrations"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Systems connected for sync + actions"})]}),n.integrations.length>0?(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:n.integrations.map(e=>{let t=e.status||"pending",s=e.healthStatus||"healthy";return(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.connector}),(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Status: ",t]})]}),(0,a.jsx)(k,{label:t.charAt(0).toUpperCase()+t.slice(1),tone:"connected"===t?"success":"pending"===t?"warning":"error"===t?"critical":"neutral"})]}),(0,a.jsx)("p",{className:"mt-3 text-xs text-[var(--ink-muted)]",children:e.lastRefreshedAt?"Last refreshed ".concat(e.lastRefreshedAt):"Awaiting first sync"}),(0,a.jsxs)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:["Health: ",s]}),e.healthDetail&&(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.healthDetail})]},e.id)})}):(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"No integrations connected yet"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Connect your CRM, calendars, phone systems, and billing to keep flows in sync and unlock downstream outcomes."})]})]}),n.insights.length>0&&(0,a.jsxs)("section",{id:"insights",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Insights"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Weekly volume trend"})]}),(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("div",{className:"flex items-end gap-3",children:n.insights.map(e=>(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 rounded-full bg-[var(--accent-soft)]",children:(0,a.jsx)("div",{className:"rounded-full bg-[var(--accent-strong)]",style:{height:"".concat(e.value,"px")}})}),(0,a.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:e.label})]},e.label))}),(0,a.jsx)("p",{className:"mt-4 text-xs text-[var(--ink-muted)]",children:"Volumes include voice, chat, and automation events."})]})]}),n.teamAccess.length>0&&(0,a.jsxs)("section",{id:"team",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Team & Access"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Shared visibility for clients + Koby ops"})]}),(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:n.teamAccess.map(e=>(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.role}),(0,a.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.count}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"Active seats"})]},e.role))})]}),n.actionRuns.length>0&&(0,a.jsxs)("section",{id:"actions",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Action Runs"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Recent executions"})]})}),(0,a.jsx)("div",{className:"mt-6 space-y-3",children:n.actionRuns.slice(0,6).map(e=>(0,a.jsxs)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:["Action ",e.actionId.slice(0,6)]}),(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Attempt ",e.attempt+1," of ",e.maxRetries]})]}),(0,a.jsx)(k,{label:e.status,tone:"succeeded"===e.status?"success":"failed"===e.status?"critical":"running"===e.status?"info":"neutral"})]}),(0,a.jsxs)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:["Started ",e.startedAt?new Date(e.startedAt).toLocaleString():"pending",e.completedAt?" • Completed ".concat(new Date(e.completedAt).toLocaleString()):""]}),e.error&&(0,a.jsxs)("p",{className:"mt-2 text-xs text-red-500",children:["Error: ",e.error]})]},e.id))})]}),l.length>0&&(0,a.jsxs)("section",{id:"outcome-events",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Outcomes"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Actions that proved ROI"})]}),(0,a.jsxs)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1 text-xs text-[var(--ink-muted)]",children:["Last ",Math.min(l.length,5)," events"]})]}),(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-3",children:l.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.outcomeType}),e.label&&(0,a.jsx)("p",{className:"text-xs text-[var(--ink-muted)] mt-1",children:e.label})]}),(0,a.jsx)("span",{className:"text-sm font-semibold text-[var(--ink)]",children:S(e.amountCents)})]}),e.actionRunId&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(k,{label:"Action run ".concat(e.actionRunId.slice(0,6)),tone:"info"})}),(0,a.jsx)("p",{className:"mt-3 text-xs text-[var(--ink-muted)]",children:new Date(e.recordedAt).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]},e.id))})]}),i.length>0&&(0,a.jsxs)("section",{id:"billing",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Billing"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Usage ledger"})]}),(0,a.jsx)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1 text-xs text-[var(--ink-muted)]",children:S(i.reduce((e,t)=>e+(t.amountCents||0),0))})]}),(0,a.jsx)("div",{className:"mt-6 space-y-3",children:i.slice(0,4).map(e=>(0,a.jsx)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.usageType}),(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)] mt-1",children:[new Date(e.periodStart).toLocaleDateString()," - ",new Date(e.periodEnd).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:S(e.amountCents)}),(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Status: ",e.status]})]})]})},e.id))})]}),n.auditLogs.length>0&&(0,a.jsxs)("section",{id:"audit-logs",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Audit Logs"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"System activity trail"})]}),(0,a.jsxs)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1 text-xs text-[var(--ink-muted)]",children:["Last ",Math.min(n.auditLogs.length,10)," events"]})]}),(0,a.jsx)("div",{className:"mt-6 space-y-3",children:n.auditLogs.slice(0,10).map(e=>{var t;return(0,a.jsx)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.eventType.replace(/_/g," ").replace(/\./g," › ")}),(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)] mt-1",children:["user"===e.actorType?"User":"system"===e.actorType?"System":"Integration",": ",e.actorId||"N/A"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-xs text-[var(--ink-muted)]",children:new Date(e.createdAt).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.targetType&&(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:[e.targetType,": ",null==(t=e.targetId)?void 0:t.slice(0,8)]})]})]})},e.id)})})]}),n.retentionPolicies.length>0&&(0,a.jsxs)("section",{id:"retention-policies",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Data Retention"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Retention and compliance policies"})]}),(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:n.retentionPolicies.map(e=>(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.dataType.replace(/_/g," ")}),(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)] mt-1",children:["Retention: ",e.ttlDays," days"]})]}),(0,a.jsx)(k,{label:e.applyAnonymization?"Anonymized":"Retained",tone:e.applyAnonymization?"info":"neutral"})]}),(0,a.jsx)("p",{className:"mt-3 text-xs text-[var(--ink-muted)]",children:e.enforcedAt?"Last enforced: ".concat(new Date(e.enforcedAt).toLocaleDateString()):"Not yet enforced"})]},e.id))})]})]}):(0,a.jsx)(R,{})}function T(e){let{data:t,clients:s,clientsError:r,cloudflareAnalytics:n,cfAnalyticsPeriod:l,onCfPeriodChange:i}=e,d=s.length,c=s.filter(e=>"active"===e.status).length,o=s.filter(e=>"at_risk"===e.status).length,x=s.filter(e=>"churned"===e.status).length,m=s.reduce((e,t)=>e+(t.todaySessions||0),0),u=s.reduce((e,t)=>e+(t.siteCount||0),0),h=new Map(t.metrics.map(e=>[e.label,e.value])),p=[{label:"Client orgs",value:A(d),note:"".concat(c," active")},{label:"At-risk accounts",value:A(o),note:"".concat(x," churned")},{label:"Sessions today",value:A(m),note:"Across all clients"},{label:"Sites monitored",value:A(u),note:"Live domains"},{label:"Total sessions (30d)",value:h.get("Total sessions")||"--",note:"Platform volume"},{label:"Leads captured",value:h.get("Leads captured")||"--",note:"Last 30 days"}];return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-16",children:[(0,a.jsxs)("section",{id:"overview",className:"pt-10",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Koby Ops"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Command center for client performance."}),(0,a.jsx)("p",{className:"mt-3 text-sm text-[var(--ink-muted)]",children:"Portfolio-level visibility across conversations, outcomes, and system health."})]}),(0,a.jsx)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-4 py-2 text-xs text-[var(--ink-muted)]",children:"Reporting window: Last 30 days"})]}),(0,a.jsx)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(e=>(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:e.label}),(0,a.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.value}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.note})]},e.label))})]}),(0,a.jsx)("section",{id:"portfolio",children:(0,a.jsx)(j,{clients:s,error:r})}),(0,a.jsxs)("section",{id:"cloudflare-analytics",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Infrastructure"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"kobyai.com Cloudflare Analytics"}),(0,a.jsx)("p",{className:"mt-3 text-sm text-[var(--ink-muted)]",children:"Real-time traffic and performance metrics from Cloudflare."})]}),(0,a.jsx)("div",{className:"flex gap-2",children:["24h","7d","30d"].map(e=>(0,a.jsx)("button",{onClick:()=>i(e),className:"rounded-full px-4 py-2 text-xs font-medium transition-colors ".concat(l===e?"bg-[var(--accent-strong)] text-white":"border border-[var(--line)] bg-[var(--panel)] text-[var(--ink-muted)] hover:bg-[var(--paper-muted)]"),children:"24h"===e?"24 Hours":"7d"===e?"7 Days":"30 Days"},e))})]}),n?(0,a.jsxs)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:"Unique Visitors"}),(0,a.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:n.uniqueVisitors.toLocaleString()}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"24h"===l?"Last 24 hours":"7d"===l?"Last 7 days":"Last 30 days"})]}),(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:"Total Requests"}),(0,a.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:n.totalRequests>=1e3?"".concat((n.totalRequests/1e3).toFixed(1),"K"):n.totalRequests.toLocaleString()}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"HTTP requests served"})]}),(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:"Percent Cached"}),(0,a.jsxs)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:[n.percentCached.toFixed(2),"%"]}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"Cache hit ratio"})]}),(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:"Total Data Served"}),(0,a.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:n.totalDataServedMB>=1e3?"".concat((n.totalDataServedMB/1e3).toFixed(1)," GB"):"".concat(n.totalDataServedMB.toFixed(0)," MB")}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"Bandwidth delivered"})]}),(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:"Data Cached"}),(0,a.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:n.dataCachedMB>=1e3?"".concat((n.dataCachedMB/1e3).toFixed(1)," GB"):"".concat(n.dataCachedMB.toFixed(0)," MB")}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"Saved from origin"})]})]}):(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"Cloudflare analytics not available"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Configure CLOUDFLARE_ZONE_ID and CLOUDFLARE_API_TOKEN in the portal worker to enable real-time analytics."})]}),(null==n?void 0:n.timeseries)&&n.timeseries.length>0&&(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)] mb-4",children:"Daily Traffic Trend"}),(0,a.jsx)("div",{className:"flex items-end gap-2 h-32",children:n.timeseries.slice(-14).map((e,t)=>{var s;let r=Math.max(...n.timeseries.slice(-14).map(e=>e.requests)),l=r>0?e.requests/r*100:0;return(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center gap-1",children:[(0,a.jsx)("div",{className:"w-full rounded-t bg-[var(--accent-soft)] transition-all",style:{height:"".concat(Math.max(l,4),"%")},children:(0,a.jsx)("div",{className:"w-full rounded-t bg-[var(--accent-strong)]",style:{height:"".concat(e.requests>0?Math.max(e.cachedRequests/e.requests*100,10):0,"%")}})}),(0,a.jsx)("span",{className:"text-[10px] text-[var(--ink-muted)]",children:(null==(s=e.timestamp)?void 0:s.slice(5,10))||""})]},t)})}),(0,a.jsxs)("div",{className:"mt-4 flex items-center gap-4 text-xs text-[var(--ink-muted)]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded bg-[var(--accent-soft)]"}),(0,a.jsx)("span",{children:"Total requests"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded bg-[var(--accent-strong)]"}),(0,a.jsx)("span",{children:"Cached requests"})]})]})]})]}),(0,a.jsxs)("section",{id:"operations",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Live Ops"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Platform health and routing status"})]}),t.engines.length>0?(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:t.engines.map(e=>(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-base font-semibold text-[var(--ink)]",children:e.title}),(0,a.jsx)("span",{className:"rounded-full px-3 py-1 text-xs font-semibold ".concat("Healthy"===e.status||"Active"===e.status||"Synced"===e.status?"bg-green-100 text-green-700":"Degraded"===e.status?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"),children:e.status})]}),(0,a.jsx)("p",{className:"mt-3 text-sm text-[var(--ink-muted)]",children:e.detail}),(0,a.jsx)("p",{className:"mt-4 text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:e.metric})]},e.title))}):(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"No engines reporting yet"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Connect your voice, chat, and automation stacks to surface live operational status."})]})]}),(0,a.jsxs)("section",{id:"automations",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Automations"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Active flows across the client fleet"})]}),t.flowTests.length>0&&(0,a.jsxs)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1 text-xs text-[var(--ink-muted)]",children:[t.flowTests.filter(e=>"passed"===e.last_result).length," / ",t.flowTests.length," tests passing"]})]}),t.flows.length>0||t.workflows.length>0?(0,a.jsx)("div",{className:"mt-6 space-y-3",children:(t.flows.length>0?t.flows:t.workflows).map(e=>{var t;let s="status"in e?e.status:"active";return(0,a.jsx)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"name"in e?e.name:"Unnamed flow"}),"description"in e&&e.description&&(0,a.jsx)("p",{className:"text-xs text-[var(--ink-muted)] line-clamp-2",children:e.description}),"lastRun"in e&&e.lastRun&&(0,a.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Last run: ",e.lastRun]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["trigger"in e&&(null==(t=e.trigger)?void 0:t.type)&&(0,a.jsx)(k,{label:"Trigger: ".concat(e.trigger.type),tone:"info"}),(0,a.jsx)(k,{label:"Status: ".concat(s),tone:"active"===s?"success":"draft"===s||"paused"===s?"warning":"neutral"})]})]})},e.id||e.name)})}):(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"No automations configured yet"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Publish your first workflows to track execution health and outcomes."})]})]}),(0,a.jsxs)("section",{id:"outcomes",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Outcomes"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Portfolio impact and ROI signals"})]}),t.outcomes.length>0?(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:t.outcomes.map(e=>(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.title}),e.change&&(0,a.jsx)("span",{className:"text-xs font-semibold px-2 py-1 rounded-full ".concat("down"===e.status?"bg-red-100 text-red-700":"flat"===e.status?"bg-[var(--paper-muted)] text-[var(--ink-muted)]":"bg-green-100 text-green-700"),children:e.change})]}),(0,a.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.value}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.note||e.horizon||"Last 30 days"})]},e.id))}):(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"Outcome tracking warming up"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"As soon as workflows are tied to billing and CRM actions, portfolio ROI will appear here."})]})]}),(0,a.jsxs)("section",{id:"insights",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Insights"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Weekly volume trend across clients"})]}),t.insights.length>0?(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("div",{className:"flex items-end gap-3",children:t.insights.map(e=>(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 rounded-full bg-[var(--accent-soft)]",children:(0,a.jsx)("div",{className:"rounded-full bg-[var(--accent-strong)]",style:{height:"".concat(e.value,"px")}})}),(0,a.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:e.label})]},e.label))}),(0,a.jsx)("p",{className:"mt-4 text-xs text-[var(--ink-muted)]",children:"Includes voice, chat, and automation sessions."})]}):(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"Insights will appear once traffic flows"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"As soon as client traffic ramps up, we will show weekly volume trends here."})]})]}),(0,a.jsxs)("section",{id:"integrations",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Integrations"}),(0,a.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Systems connected across the portfolio"})]}),t.integrations.length>0?(0,a.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:t.integrations.map(e=>{let t=e.status||"pending";return(0,a.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)] capitalize",children:e.connector})}),(0,a.jsx)(k,{label:t.charAt(0).toUpperCase()+t.slice(1),tone:"connected"===t?"success":"pending"===t?"warning":"error"===t?"critical":"neutral"})]}),(0,a.jsx)("p",{className:"mt-3 text-xs text-[var(--ink-muted)]",children:e.lastRefreshedAt?"Last synced ".concat(e.lastRefreshedAt):"Awaiting first sync"}),e.healthDetail&&(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.healthDetail})]},e.id)})}):(0,a.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"No integrations connected yet"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Connect CRMs, calendars, and telephony to consolidate portfolio reporting."})]})]})]})}function P(){var e;let{organization:t}=(0,l.Z5)(),{user:s}=(0,l.Jd)(),{getToken:d}=(0,i.d)(),c=(0,n.useSearchParams)(),o=c.get("orgId"),x=c.get("filter"),m=(null==s||null==(e=s.publicMetadata)?void 0:e.kobyRole)==="staff",u=o||(null==t?void 0:t.id)||null,h=(0,w.X)(u),p=m||(0,w.X)(null==t?void 0:t.id),v=p&&!u,[g,f]=(0,r.useState)("loading"),[b,N]=(0,r.useState)(null),[k,C]=(0,r.useState)(null),[P,D]=(0,r.useState)([]),[M,O]=(0,r.useState)(null),[E,q]=(0,r.useState)([]),[B,F]=(0,r.useState)([]),[z,U]=(0,r.useState)([]),[K,H]=(0,r.useState)([]),[W,V]=(0,r.useState)([]),[X,Z]=(0,r.useState)(null),[Y,J]=(0,r.useState)(null),[$,G]=(0,r.useState)("24h"),Q=async()=>{f("loading"),N(null);try{let N=await d();if(!N)throw Error("Not authenticated");let T=async e=>{let t=await fetch("".concat(y).concat(e),{headers:{Authorization:"Bearer ".concat(N)}});if(404===t.status)return null;if(!t.ok)throw Error("Failed to fetch ".concat(e,": ").concat(t.status));return t.json()};if(v||h)if(O(null),y)try{let e=await fetch("".concat(y,"/portal/clients").concat(x?"?filter=".concat(x):""),{headers:{Authorization:"Bearer ".concat(N)}});if(!e.ok)throw Error("Failed to fetch clients: ".concat(e.status));let t=await e.json();D(t.clients||[])}catch(e){D([]),O(e instanceof Error?e.message:"Failed to load clients")}else D([]);if(p&&y)try{let e=await fetch("".concat(y,"/portal/cloudflare-analytics?period=").concat($),{headers:{Authorization:"Bearer ".concat(N)}});if(e.ok){let t=await e.json();t.analytics&&J(t.analytics)}}catch(e){console.error("Failed to fetch Cloudflare analytics:",e)}if(v)return void f("success");if(u){var e,t,s,a,r,n,l,i,c,o,m,g,b,j,k,w,L,_,R,I;if(!y){C({metrics:[],engines:[],workflows:[],flows:[],flowTests:[],flowInsights:[],insights:[],qualitySignals:[],teamAccess:[],knowledge:null,events:[],integrations:[],outcomes:[],auditLogs:[],retentionPolicies:[],actionRuns:[]}),f("success");return}let[d,x,h,p,v,N,P,D,M]=await Promise.all([T("/portal/overview?orgId=".concat(u)),T("/portal/engines?orgId=".concat(u)),T("/portal/insights?orgId=".concat(u)),T("/portal/workflows?orgId=".concat(u)),T("/portal/events?orgId=".concat(u)),T("/portal/team?orgId=".concat(u)),T("/portal/integrations?orgId=".concat(u)),T("/portal/knowledge?orgId=".concat(u)),T("/portal/flows?orgId=".concat(u))]),O=[],E=[],B=[],z=[],K=[];if(y){let[l,i,d,c,o,x]=await Promise.allSettled([T("/outcomes?orgId=".concat(u)),T("/billing/usage?orgId=".concat(u)),T("/audit/logs?orgId=".concat(u)),T("/retention/policies?orgId=".concat(u)),T("/actions/runs?orgId=".concat(u)),T("/billing/overview?orgId=".concat(u))]);"fulfilled"===l.status&&(null==(e=l.value)?void 0:e.outcomes)&&(O=l.value.outcomes),"fulfilled"===i.status&&(null==(t=i.value)?void 0:t.records)&&(E=i.value.records),"fulfilled"===d.status&&(null==(s=d.value)?void 0:s.logs)&&(B=d.value.logs),"fulfilled"===c.status&&(null==(a=c.value)?void 0:a.policies)&&(z=c.value.policies),"fulfilled"===o.status&&(null==(r=o.value)?void 0:r.runs)&&(K=o.value.runs),"fulfilled"===x.status&&(null==(n=x.value)?void 0:n.currentPlan)&&Z(x.value.currentPlan.status)}if(!y){let e=new Date().toISOString();O=[{id:"sample_outcome",orgId:u,actionRunId:void 0,outcomeType:"lead_captured",label:"Sample outcome (worker disabled)",amountCents:0,currency:"USD",recordedAt:e,metadata:{}}],E=[{id:"sample_billing",orgId:u,usageType:"actions",quantity:0,unitPriceCents:0,amountCents:0,status:"pending",periodStart:e,periodEnd:e,externalInvoiceId:void 0,createdAt:e,updatedAt:e}],K=[{id:"sample_run",actionId:"sample_action",orgId:u,status:"pending",attempt:0,maxRetries:3,retryPolicy:"fixed",triggerSource:"demo",idempotencyKey:"demo",flowId:void 0,input:{},output:void 0,error:void 0,startedAt:e,completedAt:void 0,nextRetryAt:void 0,metadata:{},createdAt:e}]}let W=d||{org:null,sites:[],stats:{totalSessions:0,totalMessages:0,avgLatency:0,leadsCapture:0,appointmentsBooked:0,activeSessions:0},period:(()=>{let e=new Date,t=new Date;return t.setDate(e.getDate()-30),{start:t.toISOString().split("T")[0],end:e.toISOString().split("T")[0]}})()};C((l=W,i=x,c=h,o=p,m=v,g=N,b=D,j=M,k=(null==P?void 0:P.integrations)||[],w=function(e){if(!e.length)return[];let t=e.reduce((e,t)=>e+(t.amountCents||0),0);return[{id:"outcomes_count",title:"Outcomes logged",value:A(e.length),note:"Last 30 days",status:"up"},{id:"outcomes_value",title:"Captured value",value:S(t),note:"Total captured across outcomes",status:"up"}]}(O),L=B,_=z,R=K,{metrics:[{label:"Total sessions",value:A((I=l.stats).totalSessions)},{label:"Messages",value:A(I.totalMessages)},{label:"Active sessions",value:A(I.activeSessions)},{label:"Leads captured",value:A(I.leadsCapture)},{label:"Appointments booked",value:A(I.appointmentsBooked)},{label:"Avg latency",value:I.avgLatency?"".concat(Math.round(I.avgLatency)," ms"):"--"}],engines:((null==i?void 0:i.engines)||[]).map(e=>({title:e.name,status:"active"===e.status?"Active":"paused"===e.status?"Degraded":"Down",detail:e.domain?"Domain: ".concat(e.domain):"No domain configured",metric:"Sessions today: ".concat(A(e.todaySessions))})),workflows:(null==o?void 0:o.workflows)||[],flows:(null==j?void 0:j.flows)||[],flowTests:(null==j?void 0:j.tests)||[],flowInsights:(null==j?void 0:j.insights)||[],insights:((null==c?void 0:c.dailyMetrics)||[]).slice(-7).map(e=>({label:e.date.slice(5),value:e.total_sessions})),qualitySignals:((null==c?void 0:c.insights)||[]).map((e,t)=>({title:"alert"===e.type?"Alert":"warning"===e.type?"Warning":"Tip",value:"#".concat(t+1),note:e.message})),teamAccess:function(e){let t={};return e.forEach(e=>{let s=e.role||"Member";t[s]=(t[s]||0)+1}),Object.entries(t).map(e=>{let[t,s]=e;return{role:t,count:s}})}((null==g?void 0:g.team)||[]),knowledge:b||{sources:[],documents:[],policies:[]},events:(null==m?void 0:m.events)||[],integrations:k||[],outcomes:w||[],auditLogs:L||[],retentionPolicies:_||[],actionRuns:R||[]})),q(O),F(E),U(B),H(z),V(K),f("success")}else f("success")}catch(e){console.error("Error fetching portal data:",e),N(e instanceof Error?e.message:"An unexpected error occurred"),f("error")}};return((0,r.useEffect)(()=>{s&&Q()},[s,u,v,h,x,$]),"loading"===g)?(0,a.jsx)(L,{}):"error"===g&&b?(0,a.jsx)(_,{message:b,onRetry:Q}):v?(0,a.jsx)("div",{className:"max-w-6xl mx-auto pt-10",children:(0,a.jsx)(j,{clients:P,error:M})}):h&&k?(0,a.jsx)(T,{data:k,clients:P,clientsError:M,cloudflareAnalytics:Y,cfAnalyticsPeriod:$,onCfPeriodChange:G}):k?(0,a.jsx)(I,{data:k,outcomes:E,billing:B,subscriptionStatus:X,onManageBilling:async()=>{try{let e=await d();if(!e||!y)return;let t=await fetch("".concat(y,"/billing/portal-session"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({returnUrl:window.location.href})});if(t.ok){let{url:e}=await t.json();e&&(window.location.href=e)}}catch(e){console.error("Failed to open billing portal:",e)}}}):(0,a.jsx)(R,{})}function D(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)(L,{}),children:(0,a.jsx)(P,{})})}},89559:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(45105).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},e=>{e.O(0,[7141,2619,8441,1255,7358],()=>e(e.s=2449)),_N_E=e.O()}]);