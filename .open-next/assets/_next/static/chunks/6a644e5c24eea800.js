(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,36365,e=>{"use strict";var t=e.i(56878);e.s(["useAuth",()=>t.usePromisifiedAuth])},73484,e=>{"use strict";let t=(0,e.i(34281).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],73484)},82895,e=>{"use strict";let t=(0,e.i(34281).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],82895)},73852,e=>{"use strict";let t=(0,e.i(34281).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);e.s(["TrendingUp",()=>t],73852)},28739,e=>{"use strict";let t=(0,e.i(34281).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],28739)},43387,e=>{"use strict";let t=(0,e.i(34281).default)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],43387)},45721,e=>{"use strict";var t=e.i(7421),r=e.i(47094),a=e.i(48872),s=e.i(69814),n=e.i(36365),i=e.i(12933),l=e.i(73484),o=e.i(34281);let d=(0,o.default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);var c=e.i(28739);let u=(0,o.default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),m=(0,o.default)("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);var x=e.i(37865),p=e.i(79595),h=e.i(95508),v=e.i(56315);let g=(0,o.default)("Plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]]);var f=e.i(73852),b=e.i(6727),y=e.i(11031),k=e.i(43387),j=e.i(82895),w=e.i(23039);let N={branding:{logo_url:void 0,primary_color:void 0,company_name:void 0},enabled_modules:["overview","engines","insights","team"],settings:{},custom_cards:[{id:"chat_volume",title:"Chat volume",value:"--",note:"Messages this month",order:0},{id:"resolution_rate",title:"Resolution rate",value:"--",note:"Without escalation",order:1},{id:"avg_response",title:"Avg response time",value:"--",note:"First response",order:2}]},_={branding:{logo_url:void 0,primary_color:void 0,company_name:void 0},enabled_modules:["overview","engines","workflows","outcomes","knowledge","integrations","insights","team"],settings:{},custom_cards:[{id:"calls_handled",title:"Calls handled",value:"--",note:"This month",order:0},{id:"chats_resolved",title:"Chats resolved",value:"--",note:"This month",order:1},{id:"leads_qualified",title:"Leads qualified",value:"--",note:"This month",order:2},{id:"appointments",title:"Appointments booked",value:"--",note:"This month",order:3},{id:"automation_hours",title:"Automation hours saved",value:"--",note:"Across all workflows",order:4},{id:"response_time",title:"Avg response time",value:"--",note:"Voice and chat combined",order:5}]},C=[{id:"overview",label:"Overview",description:"Key metrics and status at a glance",icon:"LayoutDashboard"},{id:"engines",label:"Live Ops",description:"Real-time engine status and health",icon:"Activity"},{id:"workflows",label:"Automations",description:"Active workflows and their outcomes",icon:"Workflow"},{id:"outcomes",label:"Outcomes",description:"Tracked results across inbox, booking, and revenue",icon:"Flag"},{id:"knowledge",label:"Knowledge",description:"RAG performance and guardrail triggers",icon:"BookOpen"},{id:"integrations",label:"Integrations",description:"Connected systems and sync status",icon:"Plug"},{id:"insights",label:"Insights",description:"Trends and analytics over time",icon:"TrendingUp"},{id:"team",label:"Team & Access",description:"User management and permissions",icon:"Users"}],A=w.default.env.NEXT_PUBLIC_PORTAL_WORKER_URL||"";async function T(e,t){if(!A)return console.warn("PORTAL_WORKER_URL not configured"),null;try{let r=await fetch(`${A}/portal/config?orgId=${e}`,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok){if(404===r.status)return null;throw Error(`Failed to fetch config: ${r.status}`)}return(await r.json()).config??null}catch(e){return console.error("Error fetching portal config:",e),null}}async function S(e,t,r){if(!A)return console.warn("PORTAL_WORKER_URL not configured"),null;try{let a=await fetch(`${A}/portal/config?orgId=${e}`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error(`Failed to update config: ${a.status}`);return(await a.json()).config??null}catch(e){return console.error("Error updating portal config:",e),null}}let P={LayoutDashboard:x.LayoutDashboard,Activity:p.Activity,Workflow:h.Workflow,BookOpen:v.BookOpen,Plug:g,TrendingUp:f.TrendingUp,Users:b.Users,Flag:y.Flag},O={orgId:"demo_org",..._,updated_at:new Date().toISOString()};function L(){return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto py-10 space-y-4 animate-pulse",children:[(0,t.jsx)("div",{className:"h-6 w-32 bg-[var(--paper-muted)] rounded"}),(0,t.jsx)("div",{className:"h-10 w-48 bg-[var(--paper-muted)] rounded"}),(0,t.jsx)("div",{className:"h-64 bg-[var(--paper-muted)] rounded-3xl"})]})}function R(){let e=(0,s.useSearchParams)(),{getToken:o}=(0,n.useAuth)(),{organization:p}=(0,i.useOrganization)(),{user:h}=(0,i.useUser)(),v=e.get("orgId")||p?.id||null,[g,f]=(0,r.useState)(null),[b,y]=(0,r.useState)(!0),[w,A]=(0,r.useState)(!1),[R,M]=(0,r.useState)("idle"),[U,$]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{if(!v||!h)return y(!1);y(!0),$([]);try{let e=await o();if(!e)throw Error("Not authenticated");let t=await T(v,e);t?f(t):f({orgId:v,..._,settings:{},updated_at:new Date().toISOString()})}catch(e){console.error("Failed to load portal config",e),$([e instanceof Error?e.message:"Failed to load configuration"]),f(O)}finally{y(!1)}})()},[v,o,h]);let E=(e,t)=>{f(r=>r?{...r,branding:{...r.branding,[e]:t||null}}:r),M("idle")},F=(e,t,r)=>{f(a=>a?{...a,custom_cards:a.custom_cards.map(a=>a.id===e?{...a,[t]:r}:a)}:a),M("idle")},I=e=>{let t="chatbot_only"===e?N:_;f(e=>e?{...e,...t}:e),M("idle")},B=async()=>{if(!g||!v){$(["Select an organization before saving configuration."]),M("error");return}let e=function(e){let t=[];if(e.branding&&e.branding.primary_color&&!/^#[0-9A-Fa-f]{6}$/.test(e.branding.primary_color)&&t.push("Primary color must be a valid hex color (e.g., #f97316)"),e.enabled_modules){let r=["overview","engines","workflows","outcomes","knowledge","integrations","insights","team"];for(let a of e.enabled_modules)r.includes(a)||t.push(`Invalid module: ${a}`)}if(e.custom_cards)for(let r of e.custom_cards)r.id&&r.title||t.push("Each custom card must have an id and title");return{valid:0===t.length,errors:t}}(g);if(!e.valid){$(e.errors),M("error");return}A(!0),$([]);try{let e=await o();if(!e)throw Error("Not authenticated");let t=await S(v,{branding:g.branding,enabled_modules:g.enabled_modules,custom_cards:g.custom_cards,settings:g.settings||{}},e);t&&f(t),M("success"),setTimeout(()=>M("idle"),2e3)}catch(e){M("error"),$([e instanceof Error?e.message:"Failed to save configuration. Please try again."])}finally{A(!1)}};return v?b||!g?(0,t.jsx)(L,{}):(0,t.jsxs)("div",{className:"max-w-4xl mx-auto space-y-10 py-10",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(a.default,{href:"/portal",className:"inline-flex items-center gap-2 text-sm text-[var(--ink-muted)] hover:text-[var(--ink)] mb-3",children:[(0,t.jsx)(l.ArrowLeft,{className:"w-4 h-4"}),"Back to Portal"]}),(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Portal Settings"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Configure branding, modules, and custom metrics for this client."})]}),(0,t.jsx)("button",{onClick:B,disabled:w,className:"inline-flex items-center gap-2 rounded-full bg-[var(--accent)] px-5 py-2.5 text-sm font-semibold text-white hover:bg-[var(--accent-strong)] disabled:opacity-50 transition-colors",children:w?"Saving...":"success"===R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Check,{className:"w-4 h-4"}),"Saved"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d,{className:"w-4 h-4"}),"Save Changes"]})})]}),U.length>0&&(0,t.jsx)("div",{className:"rounded-2xl border border-red-200 bg-red-50 p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(k.AlertCircle,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-red-800",children:"Please fix the following errors:"}),(0,t.jsx)("ul",{className:"mt-2 text-sm text-red-700 list-disc list-inside",children:U.map((e,r)=>(0,t.jsx)("li",{children:e},r))})]})]})}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-[var(--ink)] mb-4",children:"Quick Presets"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,t.jsx)("button",{onClick:()=>I("chatbot_only"),className:"rounded-xl border border-[var(--line)] bg-[var(--panel)] px-4 py-2.5 text-sm text-[var(--ink)] hover:bg-[var(--paper-muted)] transition-colors",children:"Chatbot Only"}),(0,t.jsx)("button",{onClick:()=>I("full_suite"),className:"rounded-xl border border-[var(--line)] bg-[var(--panel)] px-4 py-2.5 text-sm text-[var(--ink)] hover:bg-[var(--paper-muted)] transition-colors",children:"Full AI Suite"})]})]}),(0,t.jsxs)("section",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-[var(--ink)] mb-6",children:"Branding"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-[var(--ink)] mb-2",children:"Company Name"}),(0,t.jsx)("input",{type:"text",value:g.branding.company_name||"",onChange:e=>E("company_name",e.target.value),placeholder:"Enter company name",className:"w-full rounded-xl border border-[var(--line)] bg-[var(--paper)] px-4 py-2.5 text-sm text-[var(--ink)] placeholder:text-[var(--ink-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)] focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-[var(--ink)] mb-2",children:"Primary Color"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{type:"color",value:g.branding.primary_color||"#f97316",onChange:e=>E("primary_color",e.target.value),className:"w-12 h-10 rounded-lg border border-[var(--line)] cursor-pointer"}),(0,t.jsx)("input",{type:"text",value:g.branding.primary_color||"#f97316",onChange:e=>E("primary_color",e.target.value),placeholder:"#f97316",className:"flex-1 rounded-xl border border-[var(--line)] bg-[var(--paper)] px-4 py-2.5 text-sm text-[var(--ink)] placeholder:text-[var(--ink-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)] focus:border-transparent font-mono"})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-[var(--ink)] mb-2",children:"Logo URL"}),(0,t.jsx)("input",{type:"url",value:g.branding.logo_url||"",onChange:e=>E("logo_url",e.target.value),placeholder:"https://example.com/logo.png",className:"w-full rounded-xl border border-[var(--line)] bg-[var(--paper)] px-4 py-2.5 text-sm text-[var(--ink)] placeholder:text-[var(--ink-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)] focus:border-transparent"})]})]})]}),(0,t.jsxs)("section",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-[var(--ink)] mb-2",children:"Enabled Modules"}),(0,t.jsx)("p",{className:"text-sm text-[var(--ink-muted)] mb-6",children:"Toggle which sections appear in this client's portal."}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:C.map(e=>{let r=P[e.icon]||x.LayoutDashboard,a=g.enabled_modules.includes(e.id);return(0,t.jsxs)("button",{onClick:()=>{var t;return t=e.id,void(f(e=>{if(!e)return e;let r=e.enabled_modules.includes(t);return{...e,enabled_modules:r?e.enabled_modules.filter(e=>e!==t):[...e.enabled_modules,t]}}),M("idle"))},className:`flex items-start gap-4 rounded-2xl border p-4 text-left transition-colors ${a?"border-[var(--accent)] bg-[var(--accent-soft)]":"border-[var(--line)] bg-[var(--paper)] hover:bg-[var(--paper-muted)]"}`,children:[(0,t.jsx)("div",{className:`rounded-xl p-2 ${a?"bg-[var(--accent)]":"bg-[var(--paper-muted)]"}`,children:(0,t.jsx)(r,{className:`w-5 h-5 ${a?"text-white":"text-[var(--ink-muted)]"}`})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:`text-sm font-semibold ${a?"text-[var(--accent-strong)]":"text-[var(--ink)]"}`,children:e.label}),(0,t.jsx)("p",{className:"text-xs text-[var(--ink-muted)] mt-0.5",children:e.description})]}),(0,t.jsx)("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${a?"border-[var(--accent)] bg-[var(--accent)]":"border-[var(--line)]"}`,children:a&&(0,t.jsx)(j.Check,{className:"w-3 h-3 text-white"})})]},e.id)})})]}),(0,t.jsxs)("section",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-[var(--ink)]",children:"Custom Metric Cards"}),(0,t.jsx)("p",{className:"text-sm text-[var(--ink-muted)] mt-1",children:"Configure the metrics shown in the Overview section."})]}),(0,t.jsxs)("button",{onClick:()=>{if(!g)return;let e={id:`card_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,title:"New metric",value:"--",note:"",order:g.custom_cards.length};f(t=>t?{...t,custom_cards:[...t.custom_cards,e]}:t),M("idle")},className:"inline-flex items-center gap-2 rounded-xl border border-[var(--line)] bg-[var(--paper)] px-4 py-2 text-sm text-[var(--ink)] hover:bg-[var(--paper-muted)] transition-colors",children:[(0,t.jsx)(c.Plus,{className:"w-4 h-4"}),"Add Card"]})]}),(0,t.jsx)("div",{className:"space-y-3",children:g.custom_cards.sort((e,t)=>e.order-t.order).map((e,r)=>(0,t.jsxs)("div",{className:"flex items-center gap-3 rounded-2xl border border-[var(--line)] bg-[var(--paper)] p-4",children:[(0,t.jsx)("div",{className:"flex flex-col gap-1",children:(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void(f(e=>{if(!e)return e;let r=[...e.custom_cards].sort((e,t)=>e.order-t.order),a=r.findIndex(e=>e.id===t);if(0===a)return e;let s=a-1,n=r[a].order;return r[a].order=r[s].order,r[s].order=n,{...e,custom_cards:r}}),M("idle"))},disabled:0===r,className:"p-1 text-[var(--ink-muted)] hover:text-[var(--ink)] disabled:opacity-30",children:(0,t.jsx)(m,{className:"w-4 h-4"})})}),(0,t.jsxs)("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,t.jsx)("input",{type:"text",value:e.title,onChange:t=>F(e.id,"title",t.target.value),placeholder:"Metric title",className:"rounded-lg border border-[var(--line)] bg-[var(--panel)] px-3 py-2 text-sm text-[var(--ink)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)]"}),(0,t.jsx)("input",{type:"text",value:e.value,onChange:t=>F(e.id,"value",t.target.value),placeholder:"Value",className:"rounded-lg border border-[var(--line)] bg-[var(--panel)] px-3 py-2 text-sm text-[var(--ink)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)]"}),(0,t.jsx)("input",{type:"text",value:e.note||"",onChange:t=>F(e.id,"note",t.target.value),placeholder:"Note (optional)",className:"rounded-lg border border-[var(--line)] bg-[var(--panel)] px-3 py-2 text-sm text-[var(--ink-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)]"})]}),(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void(f(e=>e?{...e,custom_cards:e.custom_cards.filter(e=>e.id!==t).map((e,t)=>({...e,order:t}))}:e),M("idle"))},className:"p-2 text-[var(--ink-muted)] hover:text-red-600 transition-colors",children:(0,t.jsx)(u,{className:"w-4 h-4"})})]},e.id))}),0===g.custom_cards.length&&(0,t.jsxs)("div",{className:"text-center py-8 text-[var(--ink-muted)]",children:[(0,t.jsx)("p",{className:"text-sm",children:"No custom cards configured."}),(0,t.jsx)("p",{className:"text-xs mt-1",children:'Click "Add Card" to create one.'})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,t.jsx)(a.default,{href:"/portal",className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-5 py-2.5 text-sm font-semibold text-[var(--ink)] hover:bg-[var(--paper-muted)] transition-colors",children:"Cancel"}),(0,t.jsx)("button",{onClick:B,disabled:w,className:"inline-flex items-center gap-2 rounded-full bg-[var(--accent)] px-5 py-2.5 text-sm font-semibold text-white hover:bg-[var(--accent-strong)] disabled:opacity-50 transition-colors",children:w?"Saving...":"Save Changes"})]})]}):(0,t.jsxs)("div",{className:"max-w-4xl mx-auto py-10 space-y-4",children:[(0,t.jsxs)(a.default,{href:"/portal",className:"inline-flex items-center gap-2 text-sm text-[var(--ink-muted)] hover:text-[var(--ink)]",children:[(0,t.jsx)(l.ArrowLeft,{className:"w-4 h-4"}),"Back to Portal"]}),(0,t.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"Select an organization"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Choose a client from the portal before configuring settings."})]})]})}function M(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)(L,{}),children:(0,t.jsx)(R,{})})}e.s(["default",()=>M],45721)}]);