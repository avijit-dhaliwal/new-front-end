(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46631,e=>{"use strict";var t=e.i(23039),s=e.i(7421),a=e.i(47094),r=e.i(69814),l=e.i(12933),i=e.i(36365),n=e.i(25557),d=e.i(61986),c=e.i(48949),o=e.i(48872),x=e.i(79595),m=e.i(94228),u=e.i(34281);let h=(0,u.default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),p=(0,u.default)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),v=(0,u.default)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);function g(e){return e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString()}function b({clients:e,isLoading:t,error:r}){let[l,i]=(0,a.useState)(""),[d,c]=(0,a.useState)("all"),u=e.filter(e=>{let t=e.name.toLowerCase().includes(l.toLowerCase()),s="all"===d||"active"===d&&"active"===e.status||"at_risk"===d&&"at_risk"===e.status;return t&&s});return t?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"h-12 bg-[var(--paper-muted)] rounded-xl animate-pulse"}),[1,2,3,4,5].map(e=>(0,s.jsx)("div",{className:"h-20 bg-[var(--paper-muted)] rounded-2xl animate-pulse"},e))]}):r?(0,s.jsxs)("div",{className:"rounded-3xl border border-red-200 dark:border-red-900 bg-red-50 dark:bg-red-900/20 p-8 text-center",children:[(0,s.jsx)(n.AlertTriangle,{className:"mx-auto h-8 w-8 text-red-500 mb-3"}),(0,s.jsx)("p",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:"Failed to load clients"}),(0,s.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:r})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Clients"}),(0,s.jsx)("h2",{className:"mt-2 text-2xl font-display font-semibold text-[var(--ink)]",children:"All Organizations"})]}),(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(h,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-[var(--ink-muted)]"}),(0,s.jsx)("input",{type:"text",placeholder:"Search clients...",value:l,onChange:e=>i(e.target.value),className:"pl-9 pr-4 py-2 text-sm rounded-xl border border-[var(--line)] bg-[var(--panel)] text-[var(--ink)] placeholder-[var(--ink-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)] focus:border-transparent w-48 sm:w-64"})]})})]}),(0,s.jsx)("div",{className:"flex gap-2 border-b border-[var(--line)] pb-3",children:["all","active","at_risk"].map(t=>(0,s.jsxs)("button",{onClick:()=>c(t),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${d===t?"bg-[var(--accent-soft)] text-[var(--accent-strong)]":"text-[var(--ink-muted)] hover:bg-[var(--paper-muted)] hover:text-[var(--ink)]"}`,children:["all"===t?"All":"active"===t?"Active":"At Risk",d===t&&(0,s.jsxs)("span",{className:"ml-2 text-xs",children:["(","all"===t?e.length:u.length,")"]})]},t))}),0===u.length&&(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-12 text-center",children:[(0,s.jsx)(x.Activity,{className:"mx-auto h-10 w-10 text-[var(--ink-muted)] mb-4"}),(0,s.jsx)("p",{className:"text-sm font-medium text-[var(--ink)]",children:"No clients found"}),(0,s.jsx)("p",{className:"text-xs text-[var(--ink-muted)] mt-1",children:l?"Try adjusting your search":"No clients match the current filter"})]}),(0,s.jsx)("div",{className:"space-y-3",children:u.map(e=>(0,s.jsxs)(o.default,{href:`/portal?orgId=${e.id}`,className:"block rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)] hover:shadow-lg hover:border-[var(--ink-muted)]/30 transition-all duration-200 group",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-[var(--ink)] truncate group-hover:text-[var(--accent-strong)] transition-colors",children:e.name}),function(e){switch(e){case"active":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-green-100 dark:bg-green-900/30 px-2.5 py-0.5 text-xs font-medium text-green-700 dark:text-green-400",children:[(0,s.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),"Active"]});case"inactive":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-blue-100 dark:bg-blue-900/30 px-2.5 py-0.5 text-xs font-medium text-blue-700 dark:text-blue-400",children:[(0,s.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-blue-500"}),"Inactive"]});case"at_risk":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-amber-100 dark:bg-amber-900/30 px-2.5 py-0.5 text-xs font-medium text-amber-700 dark:text-amber-400",children:[(0,s.jsx)(n.AlertTriangle,{className:"h-3 w-3"}),"At Risk"]});case"churned":return(0,s.jsx)("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-gray-100 dark:bg-gray-800 px-2.5 py-0.5 text-xs font-medium text-gray-600 dark:text-gray-400",children:"Churned"})}}(e.status)]}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-[var(--ink-muted)]",children:[e.plan," plan"]})]}),(0,s.jsxs)("div",{className:"hidden sm:flex items-center gap-8",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5 text-[var(--ink-muted)]",children:[(0,s.jsx)(m.Clock,{className:"h-3.5 w-3.5"}),(0,s.jsx)("span",{className:"text-xs",children:"Last Activity"})]}),(0,s.jsx)("p",{className:"mt-1 text-sm font-medium text-[var(--ink)]",children:e.lastActivity||"N/A"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5 text-[var(--ink-muted)]",children:[(0,s.jsx)(x.Activity,{className:"h-3.5 w-3.5"}),(0,s.jsx)("span",{className:"text-xs",children:"Today"})]}),(0,s.jsxs)("p",{className:"mt-1 text-sm font-medium text-[var(--ink)]",children:[g(e.todaySessions)," sessions"]})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5 text-[var(--ink-muted)]",children:[(0,s.jsx)(v,{className:"h-3.5 w-3.5"}),(0,s.jsx)("span",{className:"text-xs",children:"Sites"})]}),(0,s.jsx)("p",{className:"mt-1 text-sm font-bold text-[var(--ink)]",children:e.siteCount})]})]}),(0,s.jsx)(p,{className:"h-5 w-5 text-[var(--ink-muted)] group-hover:text-[var(--accent-strong)] group-hover:translate-x-1 transition-all"})]}),(0,s.jsxs)("div",{className:"sm:hidden mt-4 grid grid-cols-3 gap-4 pt-4 border-t border-[var(--line)]",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-[var(--ink-muted)]",children:"Last Activity"}),(0,s.jsx)("p",{className:"text-sm font-medium text-[var(--ink)]",children:e.lastActivity||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-[var(--ink-muted)]",children:"Sessions"}),(0,s.jsx)("p",{className:"text-sm font-medium text-[var(--ink)]",children:g(e.todaySessions)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-[var(--ink-muted)]",children:"Sites"}),(0,s.jsx)("p",{className:"text-sm font-bold text-[var(--ink)]",children:e.siteCount})]})]})]},e.id))})]})}let f={success:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300",warning:"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400",critical:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400",info:"bg-[var(--accent-soft)] text-[var(--accent-strong)]",neutral:"bg-[var(--paper-muted)] text-[var(--ink-muted)]"};function j({label:e,tone:t="neutral"}){return(0,s.jsx)("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${f[t]}`,children:e})}var N=e.i(68768);let k=t.default.env.NEXT_PUBLIC_PORTAL_WORKER_URL||"",w=e=>Number.isFinite(e)?e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toLocaleString():"--",y=e=>null==e?"--":`$${(e/100).toFixed(2)}`;function A(){return(0,s.jsx)("div",{className:"max-w-6xl mx-auto space-y-16 animate-pulse",children:(0,s.jsxs)("section",{className:"pt-10",children:[(0,s.jsx)("div",{className:"h-6 w-24 bg-[var(--paper-muted)] rounded mb-4"}),(0,s.jsx)("div",{className:"h-10 w-96 bg-[var(--paper-muted)] rounded mb-4"}),(0,s.jsx)("div",{className:"h-4 w-72 bg-[var(--paper-muted)] rounded"}),(0,s.jsx)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>(0,s.jsx)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 h-32"},e))})]})})}function S({message:e,onRetry:t}){return(0,s.jsx)("div",{className:"max-w-6xl mx-auto pt-10",children:(0,s.jsxs)("div",{className:"rounded-3xl border border-red-200 dark:border-red-900 bg-red-50 dark:bg-red-900/20 p-8 text-center",children:[(0,s.jsx)(n.AlertTriangle,{className:"mx-auto h-10 w-10 text-red-500 mb-4"}),(0,s.jsx)("h2",{className:"text-lg font-semibold text-red-800 dark:text-red-300 mb-2",children:"Failed to load portal data"}),(0,s.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400 mb-6",children:e}),(0,s.jsxs)("button",{onClick:t,className:"inline-flex items-center gap-2 rounded-full border border-red-300 dark:border-red-700 bg-white dark:bg-red-900/30 px-4 py-2 text-sm font-medium text-red-700 dark:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/50 transition-colors",children:[(0,s.jsx)(c.RefreshCw,{className:"h-4 w-4"}),"Try again"]})]})})}function $({status:e,onManageBilling:t}){if(!e||"past_due"!==e&&"unpaid"!==e)return null;let a="past_due"===e;return(0,s.jsx)("div",{className:`rounded-2xl border p-4 mb-6 ${a?"border-amber-200 dark:border-amber-900 bg-amber-50 dark:bg-amber-900/20":"border-red-200 dark:border-red-900 bg-red-50 dark:bg-red-900/20"}`,children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(n.AlertTriangle,{className:`h-5 w-5 mt-0.5 ${a?"text-amber-500":"text-red-500"}`}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:`text-sm font-semibold ${a?"text-amber-800 dark:text-amber-300":"text-red-800 dark:text-red-300"}`,children:a?"Payment Past Due":"Payment Required"}),(0,s.jsx)("p",{className:`text-sm mt-1 ${a?"text-amber-700 dark:text-amber-400":"text-red-700 dark:text-red-400"}`,children:a?"Your subscription payment is past due. Please update your payment method to avoid service interruption.":"Your subscription is unpaid. Please update your payment method to restore full access to your AI services."}),(0,s.jsx)("button",{onClick:t,className:`mt-3 inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-medium transition-colors ${a?"border border-amber-300 dark:border-amber-700 bg-white dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 hover:bg-amber-50 dark:hover:bg-amber-900/50":"border border-red-300 dark:border-red-700 bg-white dark:bg-red-900/30 text-red-700 dark:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/50"}`,children:"Manage Billing"})]})]})})}function L(){return(0,s.jsx)("div",{className:"max-w-6xl mx-auto pt-10",children:(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-12 text-center shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("div",{className:"mx-auto h-16 w-16 rounded-2xl bg-[var(--accent-soft)] flex items-center justify-center mb-6",children:(0,s.jsx)(d.Loader2,{className:"h-8 w-8 text-[var(--accent)]"})}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-[var(--ink)] mb-2",children:"Setting up your portal"}),(0,s.jsx)("p",{className:"text-sm text-[var(--ink-muted)] max-w-md mx-auto",children:"Your portal is being configured. Data will appear here once your AI services are active and generating metrics."})]})})}function I({data:e,outcomes:t,billing:a,subscriptionStatus:r,onManageBilling:l}){return e.metrics.some(e=>{let t=Number(e.value.replace(/[^0-9.]/g,""));return Number.isFinite(t)&&t>0})||e.engines.length>0||e.workflows.length>0||e.flows.length>0||e.flowTests.length>0||e.flowInsights.length>0||e.insights.length>0||e.qualitySignals.length>0||e.knowledge&&(e.knowledge.sources.length>0||e.knowledge.documents.length>0)||e.teamAccess.length>0||e.integrations.length>0||e.outcomes.length>0||e.actionRuns.length>0||e.auditLogs.length>0||e.retentionPolicies.length>0||e.events.length>0||t.length>0||a.length>0?(0,s.jsxs)("div",{className:"max-w-6xl mx-auto space-y-16",children:[(0,s.jsx)("div",{className:"pt-10",children:(0,s.jsx)($,{status:r,onManageBilling:l})}),(0,s.jsxs)("section",{id:"overview",className:r&&("past_due"===r||"unpaid"===r)?"":"pt-10",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Overview"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Your AI operations, at a glance."}),(0,s.jsx)("p",{className:"mt-3 text-sm text-[var(--ink-muted)]",children:"All metrics are aggregated and anonymized for security."})]}),(0,s.jsx)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-4 py-2 text-xs text-[var(--ink-muted)]",children:"Reporting window: Last 30 days"})]}),(0,s.jsx)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:e.metrics.map(e=>(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:e.label}),(0,s.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.value}),e.change&&(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.change})]},e.label))})]}),e.engines.length>0&&(0,s.jsxs)("section",{id:"operations",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Live Ops"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Core engines status"})]}),(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:e.engines.map(e=>(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-base font-semibold text-[var(--ink)]",children:e.title}),(0,s.jsx)("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${"Healthy"===e.status||"Active"===e.status||"Synced"===e.status?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"Degraded"===e.status?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"}`,children:e.status})]}),(0,s.jsx)("p",{className:"mt-3 text-sm text-[var(--ink-muted)]",children:e.detail}),(0,s.jsx)("p",{className:"mt-4 text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:e.metric})]},e.title))})]}),e.auditLogs.length>0&&(0,s.jsxs)("section",{id:"audit",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Audit Logs"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Compliance trail"})]}),(0,s.jsx)("div",{className:"mt-6 space-y-3",children:e.auditLogs.slice(0,8).map(e=>(0,s.jsxs)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.eventType}),(0,s.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:new Date(e.createdAt).toLocaleString()})]}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-[var(--ink-muted)]",children:["Actor: ",e.actorType||"system"," ",e.actorId?`(${e.actorId})`:""]}),e.targetType&&(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Target: ",e.targetType," ",e.targetId||""]})]},e.id))})]}),e.retentionPolicies.length>0&&(0,s.jsxs)("section",{id:"retention",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Retention"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Data lifecycle controls"})]}),(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-3",children:e.retentionPolicies.map(e=>(0,s.jsxs)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.dataType}),(0,s.jsx)(j,{label:`${e.ttlDays} days`,tone:"neutral"})]}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.applyAnonymization?"Anonymize before delete":"Delete on expiry"}),e.enforcedAt&&(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Enforced: ",new Date(e.enforcedAt).toLocaleDateString()]})]},e.id))})]}),e.events.length>0&&(0,s.jsxs)("section",{id:"activity",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Recent Activity"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Latest conversations and actions"})]}),(0,s.jsx)("div",{className:"mt-6 space-y-3",children:e.events.slice(0,15).map(e=>(0,s.jsxs)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-semibold text-[var(--ink)]",children:function(e){switch(e.type){case"session_started":return"Session started";case"session_ended":return"Session ended";case"user_message":return"Visitor message";case"assistant_message":return"Assistant response";case"lead_captured":return"Lead captured";case"appointment_booked":return"Appointment booked";case"action_run":return"Action run";case"outcome_recorded":return"Outcome recorded";default:return e.type}}(e)}),(0,s.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:"•"}),(0,s.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:new Date(e.created_at).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,s.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:e.session_id?`Session ${e.session_id.slice(0,8)}`:""})]}),e.content&&(0,s.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)] line-clamp-2",children:e.content}),(0,s.jsxs)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:["Site ",e.site_id.slice(0,8)," · Org ",e.org_id.slice(0,8)]})]},e.id))})]}),(e.flows.length>0||e.workflows.length>0)&&(0,s.jsxs)("section",{id:"automations",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Automations"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Flows powering actions"})]}),e.flowTests.length>0&&(0,s.jsxs)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1 text-xs text-[var(--ink-muted)]",children:[e.flowTests.filter(e=>"passed"===e.last_result).length," / ",e.flowTests.length," tests passing"]})]}),(0,s.jsx)("div",{className:"mt-6 space-y-3",children:(e.flows.length>0?e.flows:e.workflows).map(e=>{let t="status"in e?e.status:"active";return(0,s.jsx)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"name"in e?e.name:"Unnamed flow"}),"description"in e&&e.description&&(0,s.jsx)("p",{className:"text-xs text-[var(--ink-muted)] line-clamp-2",children:e.description}),"lastRun"in e&&e.lastRun&&(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Last run: ",e.lastRun]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["trigger"in e&&e.trigger?.type&&(0,s.jsx)(j,{label:`Trigger: ${e.trigger.type}`,tone:"info"}),(0,s.jsx)(j,{label:`Status: ${t}`,tone:"active"===t?"success":"draft"===t||"paused"===t?"warning":"neutral"})]})]})},e.id||e.name)})}),e.flowTests.length>0&&(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)] mb-4",children:"Flow tests"}),(0,s.jsx)("div",{className:"space-y-3",children:e.flowTests.slice(0,5).map(e=>{let t="passed"===e.last_result?"success":"failed"===e.last_result?"critical":"warning";return(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3 rounded-2xl border border-[var(--line)] bg-[var(--paper)] p-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Expected: ",e.expected_outcome]})]}),(0,s.jsx)(j,{label:e.last_result||"not run",tone:t})]},e.id)})})]}),e.flowInsights.length>0&&(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)] mb-4",children:"Recent flow runs"}),(0,s.jsx)("div",{className:"space-y-3",children:e.flowInsights.slice(0,5).map(e=>{let t="success"===e.outcome?"success":"handoff"===e.outcome?"info":"failed"===e.outcome?"critical":"warning";return(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3 rounded-2xl border border-[var(--line)] bg-[var(--paper)] p-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.flow_id}),(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:[new Date(e.started_at).toLocaleString()," · ",Math.round(e.duration_ms)," ms"]})]}),(0,s.jsx)(j,{label:e.outcome,tone:t})]},e.run_id)})})]})]}),(0,s.jsxs)("section",{id:"outcomes",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Outcomes"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Proof of impact across inbox, bookings, and revenue"})]}),e.outcomes.length>0?(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:e.outcomes.map(e=>(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.title}),e.change&&(0,s.jsx)("span",{className:`text-xs font-semibold px-2 py-1 rounded-full ${"down"===e.status?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300":"flat"===e.status?"bg-[var(--paper-muted)] text-[var(--ink-muted)]":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300"}`,children:e.change})]}),(0,s.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.value}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.note||e.horizon||"Last 30 days"})]},e.id))}):(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"Outcome tracking coming online"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Once flows are paired with billing, scheduling, and CRM actions, we'll show closed-loop outcomes here—bookings, payments, recoveries, and review wins."})]})]}),(0,s.jsxs)("section",{id:"knowledge",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Knowledge"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Sources, versions, and policy guardrails"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 text-xs text-[var(--ink-muted)]",children:[(0,s.jsxs)("span",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1",children:[e.knowledge?.sources.length||0," sources"]}),(0,s.jsxs)("span",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1",children:[e.knowledge?.documents.length||0," documents"]}),(0,s.jsxs)("span",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1",children:[e.knowledge?.policies.length||0," policies"]})]})]}),e.knowledge&&e.knowledge.sources.length>0?(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:e.knowledge.sources.map(e=>{let t="connected"===e.status?"success":"syncing"===e.status?"warning":"error"===e.status?"critical":"neutral";return(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)] capitalize",children:[e.type," source"]})]}),(0,s.jsx)(j,{label:e.status,tone:t})]}),(0,s.jsx)("p",{className:"mt-3 text-xs text-[var(--ink-muted)]",children:e.last_synced_at?`Last synced ${new Date(e.last_synced_at).toLocaleString()}`:"Waiting on first sync"}),e.error_message&&(0,s.jsx)("p",{className:"mt-2 text-xs text-red-600",children:e.error_message})]},e.id)})}):(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"No sources connected yet"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Link files, URLs, and apps to ground the assistant. Sync status and errors will show here once Agent 3 plugs in ingestion."})]}),e.knowledge&&e.knowledge.documents.length>0&&(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)] mb-4",children:"Latest documents"}),(0,s.jsx)("div",{className:"space-y-3",children:e.knowledge.documents.slice(0,4).map(e=>{let t="ready"===e.status?"success":"processing"===e.status?"warning":"failed"===e.status?"critical":"neutral";return(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3 rounded-2xl border border-[var(--line)] bg-[var(--paper)] p-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.title}),(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:[e.mime_type||"Unknown type"," · ",e.size_bytes?`${Math.round(e.size_bytes/1024)} KB`:"Size pending"]})]}),(0,s.jsx)(j,{label:e.status,tone:t})]},e.id)})})]}),e.qualitySignals.length>0&&(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:e.qualitySignals.map(e=>(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.title}),(0,s.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.value}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.note})]},e.title))})]}),(0,s.jsxs)("section",{id:"integrations",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Integrations"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Systems connected for sync + actions"})]}),e.integrations.length>0?(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:e.integrations.map(e=>{let t=e.status||"pending",a=e.healthStatus||"healthy";return(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.connector}),(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Status: ",t]})]}),(0,s.jsx)(j,{label:t.charAt(0).toUpperCase()+t.slice(1),tone:"connected"===t?"success":"pending"===t?"warning":"error"===t?"critical":"neutral"})]}),(0,s.jsx)("p",{className:"mt-3 text-xs text-[var(--ink-muted)]",children:e.lastRefreshedAt?`Last refreshed ${e.lastRefreshedAt}`:"Awaiting first sync"}),(0,s.jsxs)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:["Health: ",a]}),e.healthDetail&&(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.healthDetail})]},e.id)})}):(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"No integrations connected yet"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Connect your CRM, calendars, phone systems, and billing to keep flows in sync and unlock downstream outcomes."})]})]}),e.insights.length>0&&(0,s.jsxs)("section",{id:"insights",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Insights"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Weekly volume trend"})]}),(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("div",{className:"flex items-end gap-3",children:e.insights.map(e=>(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,s.jsx)("div",{className:"w-8 rounded-full bg-[var(--accent-soft)]",children:(0,s.jsx)("div",{className:"rounded-full bg-[var(--accent-strong)]",style:{height:`${e.value}px`}})}),(0,s.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:e.label})]},e.label))}),(0,s.jsx)("p",{className:"mt-4 text-xs text-[var(--ink-muted)]",children:"Volumes include voice, chat, and automation events."})]})]}),e.teamAccess.length>0&&(0,s.jsxs)("section",{id:"team",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Team & Access"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Shared visibility for clients + Koby ops"})]}),(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:e.teamAccess.map(e=>(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.role}),(0,s.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.count}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"Active seats"})]},e.role))})]}),e.actionRuns.length>0&&(0,s.jsxs)("section",{id:"actions",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Action Runs"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Recent executions"})]})}),(0,s.jsx)("div",{className:"mt-6 space-y-3",children:e.actionRuns.slice(0,6).map(e=>(0,s.jsxs)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:["Action ",e.actionId.slice(0,6)]}),(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Attempt ",e.attempt+1," of ",e.maxRetries]})]}),(0,s.jsx)(j,{label:e.status,tone:"succeeded"===e.status?"success":"failed"===e.status?"critical":"running"===e.status?"info":"neutral"})]}),(0,s.jsxs)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:["Started ",e.startedAt?new Date(e.startedAt).toLocaleString():"pending",e.completedAt?` • Completed ${new Date(e.completedAt).toLocaleString()}`:""]}),e.error&&(0,s.jsxs)("p",{className:"mt-2 text-xs text-red-500",children:["Error: ",e.error]})]},e.id))})]}),t.length>0&&(0,s.jsxs)("section",{id:"outcome-events",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Outcomes"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Actions that proved ROI"})]}),(0,s.jsxs)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1 text-xs text-[var(--ink-muted)]",children:["Last ",Math.min(t.length,5)," events"]})]}),(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-3",children:t.slice(0,5).map(e=>(0,s.jsxs)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.outcomeType}),e.label&&(0,s.jsx)("p",{className:"text-xs text-[var(--ink-muted)] mt-1",children:e.label})]}),(0,s.jsx)("span",{className:"text-sm font-semibold text-[var(--ink)]",children:y(e.amountCents)})]}),e.actionRunId&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(j,{label:`Action run ${e.actionRunId.slice(0,6)}`,tone:"info"})}),(0,s.jsx)("p",{className:"mt-3 text-xs text-[var(--ink-muted)]",children:new Date(e.recordedAt).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]},e.id))})]}),a.length>0&&(0,s.jsxs)("section",{id:"billing",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Billing"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Usage ledger"})]}),(0,s.jsx)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1 text-xs text-[var(--ink-muted)]",children:y(a.reduce((e,t)=>e+(t.amountCents||0),0))})]}),(0,s.jsx)("div",{className:"mt-6 space-y-3",children:a.slice(0,4).map(e=>(0,s.jsx)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.usageType}),(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)] mt-1",children:[new Date(e.periodStart).toLocaleDateString()," - ",new Date(e.periodEnd).toLocaleDateString()]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:y(e.amountCents)}),(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Status: ",e.status]})]})]})},e.id))})]}),e.auditLogs.length>0&&(0,s.jsxs)("section",{id:"audit-logs",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Audit Logs"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"System activity trail"})]}),(0,s.jsxs)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1 text-xs text-[var(--ink-muted)]",children:["Last ",Math.min(e.auditLogs.length,10)," events"]})]}),(0,s.jsx)("div",{className:"mt-6 space-y-3",children:e.auditLogs.slice(0,10).map(e=>(0,s.jsx)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-4 shadow-[var(--shadow-soft)]",children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.eventType.replace(/_/g," ").replace(/\./g," › ")}),(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)] mt-1",children:["user"===e.actorType?"User":"system"===e.actorType?"System":"Integration",": ",e.actorId||"N/A"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-xs text-[var(--ink-muted)]",children:new Date(e.createdAt).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.targetType&&(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:[e.targetType,": ",e.targetId?.slice(0,8)]})]})]})},e.id))})]}),e.retentionPolicies.length>0&&(0,s.jsxs)("section",{id:"retention-policies",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Data Retention"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Retention and compliance policies"})]}),(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:e.retentionPolicies.map(e=>(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.dataType.replace(/_/g," ")}),(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)] mt-1",children:["Retention: ",e.ttlDays," days"]})]}),(0,s.jsx)(j,{label:e.applyAnonymization?"Anonymized":"Retained",tone:e.applyAnonymization?"info":"neutral"})]}),(0,s.jsx)("p",{className:"mt-3 text-xs text-[var(--ink-muted)]",children:e.enforcedAt?`Last enforced: ${new Date(e.enforcedAt).toLocaleDateString()}`:"Not yet enforced"})]},e.id))})]})]}):(0,s.jsx)(L,{})}function R({data:e,clients:t,clientsError:a,cloudflareAnalytics:r,cfAnalyticsPeriod:l,onCfPeriodChange:i}){let n=t.length,d=t.filter(e=>"active"===e.status).length,c=t.filter(e=>"at_risk"===e.status).length,o=t.filter(e=>"churned"===e.status).length,x=t.reduce((e,t)=>e+(t.todaySessions||0),0),m=t.reduce((e,t)=>e+(t.siteCount||0),0),u=new Map(e.metrics.map(e=>[e.label,e.value])),h=[{label:"Client orgs",value:w(n),note:`${d} active`},{label:"At-risk accounts",value:w(c),note:`${o} churned`},{label:"Sessions today",value:w(x),note:"Across all clients"},{label:"Sites monitored",value:w(m),note:"Live domains"},{label:"Total sessions (30d)",value:u.get("Total sessions")||"--",note:"Platform volume"},{label:"Leads captured",value:u.get("Leads captured")||"--",note:"Last 30 days"}];return(0,s.jsxs)("div",{className:"max-w-6xl mx-auto space-y-16",children:[(0,s.jsxs)("section",{id:"overview",className:"pt-10",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Koby Ops"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Command center for client performance."}),(0,s.jsx)("p",{className:"mt-3 text-sm text-[var(--ink-muted)]",children:"Portfolio-level visibility across conversations, outcomes, and system health."})]}),(0,s.jsx)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-4 py-2 text-xs text-[var(--ink-muted)]",children:"Reporting window: Last 30 days"})]}),(0,s.jsx)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(e=>(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:e.label}),(0,s.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.value}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.note})]},e.label))})]}),(0,s.jsx)("section",{id:"portfolio",children:(0,s.jsx)(b,{clients:t,error:a})}),(0,s.jsxs)("section",{id:"cloudflare-analytics",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Infrastructure"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"kobyai.com Cloudflare Analytics"}),(0,s.jsx)("p",{className:"mt-3 text-sm text-[var(--ink-muted)]",children:"Real-time traffic and performance metrics from Cloudflare."})]}),(0,s.jsx)("div",{className:"flex gap-2",children:["24h","7d","30d"].map(e=>(0,s.jsx)("button",{onClick:()=>i(e),className:`rounded-full px-4 py-2 text-xs font-medium transition-colors ${l===e?"bg-[var(--accent-strong)] text-white":"border border-[var(--line)] bg-[var(--panel)] text-[var(--ink-muted)] hover:bg-[var(--paper-muted)]"}`,children:"24h"===e?"24 Hours":"7d"===e?"7 Days":"30 Days"},e))})]}),r?(0,s.jsxs)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:"Unique Visitors"}),(0,s.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:r.uniqueVisitors.toLocaleString()}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"24h"===l?"Last 24 hours":"7d"===l?"Last 7 days":"Last 30 days"})]}),(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:"Total Requests"}),(0,s.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:r.totalRequests>=1e3?`${(r.totalRequests/1e3).toFixed(1)}K`:r.totalRequests.toLocaleString()}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"HTTP requests served"})]}),(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:"Percent Cached"}),(0,s.jsxs)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:[r.percentCached.toFixed(2),"%"]}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"Cache hit ratio"})]}),(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:"Total Data Served"}),(0,s.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:r.totalDataServedMB>=1e3?`${(r.totalDataServedMB/1e3).toFixed(1)} GB`:`${r.totalDataServedMB.toFixed(0)} MB`}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"Bandwidth delivered"})]}),(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:"Data Cached"}),(0,s.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:r.dataCachedMB>=1e3?`${(r.dataCachedMB/1e3).toFixed(1)} GB`:`${r.dataCachedMB.toFixed(0)} MB`}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:"Saved from origin"})]})]}):(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"Cloudflare analytics not available"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Configure CLOUDFLARE_ZONE_ID and CLOUDFLARE_API_TOKEN in the portal worker to enable real-time analytics."})]}),r?.timeseries&&r.timeseries.length>0&&(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)] mb-4",children:"Daily Traffic Trend"}),(0,s.jsx)("div",{className:"flex items-end gap-2 h-32",children:r.timeseries.slice(-14).map((e,t)=>{let a=Math.max(...r.timeseries.slice(-14).map(e=>e.requests)),l=a>0?e.requests/a*100:0;return(0,s.jsxs)("div",{className:"flex-1 flex flex-col items-center gap-1",children:[(0,s.jsx)("div",{className:"w-full rounded-t bg-[var(--accent-soft)] transition-all",style:{height:`${Math.max(l,4)}%`},children:(0,s.jsx)("div",{className:"w-full rounded-t bg-[var(--accent-strong)]",style:{height:`${e.requests>0?Math.max(e.cachedRequests/e.requests*100,10):0}%`}})}),(0,s.jsx)("span",{className:"text-[10px] text-[var(--ink-muted)]",children:e.timestamp?.slice(5,10)||""})]},t)})}),(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-4 text-xs text-[var(--ink-muted)]",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded bg-[var(--accent-soft)]"}),(0,s.jsx)("span",{children:"Total requests"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded bg-[var(--accent-strong)]"}),(0,s.jsx)("span",{children:"Cached requests"})]})]})]})]}),(0,s.jsxs)("section",{id:"operations",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Live Ops"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Platform health and routing status"})]}),e.engines.length>0?(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:e.engines.map(e=>(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-base font-semibold text-[var(--ink)]",children:e.title}),(0,s.jsx)("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${"Healthy"===e.status||"Active"===e.status||"Synced"===e.status?"bg-green-100 text-green-700":"Degraded"===e.status?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:e.status})]}),(0,s.jsx)("p",{className:"mt-3 text-sm text-[var(--ink-muted)]",children:e.detail}),(0,s.jsx)("p",{className:"mt-4 text-xs uppercase tracking-[0.2em] text-[var(--ink-muted)]",children:e.metric})]},e.title))}):(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"No engines reporting yet"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Connect your voice, chat, and automation stacks to surface live operational status."})]})]}),(0,s.jsxs)("section",{id:"automations",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Automations"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Active flows across the client fleet"})]}),e.flowTests.length>0&&(0,s.jsxs)("div",{className:"rounded-full border border-[var(--line)] bg-[var(--panel)] px-3 py-1 text-xs text-[var(--ink-muted)]",children:[e.flowTests.filter(e=>"passed"===e.last_result).length," / ",e.flowTests.length," tests passing"]})]}),e.flows.length>0||e.workflows.length>0?(0,s.jsx)("div",{className:"mt-6 space-y-3",children:(e.flows.length>0?e.flows:e.workflows).map(e=>{let t="status"in e?e.status:"active";return(0,s.jsx)("div",{className:"rounded-2xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"name"in e?e.name:"Unnamed flow"}),"description"in e&&e.description&&(0,s.jsx)("p",{className:"text-xs text-[var(--ink-muted)] line-clamp-2",children:e.description}),"lastRun"in e&&e.lastRun&&(0,s.jsxs)("p",{className:"text-xs text-[var(--ink-muted)]",children:["Last run: ",e.lastRun]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["trigger"in e&&e.trigger?.type&&(0,s.jsx)(j,{label:`Trigger: ${e.trigger.type}`,tone:"info"}),(0,s.jsx)(j,{label:`Status: ${t}`,tone:"active"===t?"success":"draft"===t||"paused"===t?"warning":"neutral"})]})]})},e.id||e.name)})}):(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"No automations configured yet"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Publish your first workflows to track execution health and outcomes."})]})]}),(0,s.jsxs)("section",{id:"outcomes",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Outcomes"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Portfolio impact and ROI signals"})]}),e.outcomes.length>0?(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:e.outcomes.map(e=>(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:e.title}),e.change&&(0,s.jsx)("span",{className:`text-xs font-semibold px-2 py-1 rounded-full ${"down"===e.status?"bg-red-100 text-red-700":"flat"===e.status?"bg-[var(--paper-muted)] text-[var(--ink-muted)]":"bg-green-100 text-green-700"}`,children:e.change})]}),(0,s.jsx)("p",{className:"mt-3 text-2xl font-semibold text-[var(--ink)]",children:e.value}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.note||e.horizon||"Last 30 days"})]},e.id))}):(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"Outcome tracking warming up"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"As soon as workflows are tied to billing and CRM actions, portfolio ROI will appear here."})]})]}),(0,s.jsxs)("section",{id:"insights",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Insights"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Weekly volume trend across clients"})]}),e.insights.length>0?(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("div",{className:"flex items-end gap-3",children:e.insights.map(e=>(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,s.jsx)("div",{className:"w-8 rounded-full bg-[var(--accent-soft)]",children:(0,s.jsx)("div",{className:"rounded-full bg-[var(--accent-strong)]",style:{height:`${e.value}px`}})}),(0,s.jsx)("span",{className:"text-xs text-[var(--ink-muted)]",children:e.label})]},e.label))}),(0,s.jsx)("p",{className:"mt-4 text-xs text-[var(--ink-muted)]",children:"Includes voice, chat, and automation sessions."})]}):(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"Insights will appear once traffic flows"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"As soon as client traffic ramps up, we will show weekly volume trends here."})]})]}),(0,s.jsxs)("section",{id:"integrations",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-[var(--ink-muted)]",children:"Integrations"}),(0,s.jsx)("h2",{className:"mt-3 text-2xl sm:text-3xl font-display font-semibold text-[var(--ink)]",children:"Systems connected across the portfolio"})]}),e.integrations.length>0?(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:e.integrations.map(e=>{let t=e.status||"pending";return(0,s.jsxs)("div",{className:"rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-5 shadow-[var(--shadow-soft)]",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsx)("div",{children:(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)] capitalize",children:e.connector})}),(0,s.jsx)(j,{label:t.charAt(0).toUpperCase()+t.slice(1),tone:"connected"===t?"success":"pending"===t?"warning":"error"===t?"critical":"neutral"})]}),(0,s.jsx)("p",{className:"mt-3 text-xs text-[var(--ink-muted)]",children:e.lastRefreshedAt?`Last synced ${e.lastRefreshedAt}`:"Awaiting first sync"}),e.healthDetail&&(0,s.jsx)("p",{className:"mt-2 text-xs text-[var(--ink-muted)]",children:e.healthDetail})]},e.id)})}):(0,s.jsxs)("div",{className:"mt-6 rounded-3xl border border-[var(--line)] bg-[var(--panel)] p-6 shadow-[var(--shadow-soft)]",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-[var(--ink)]",children:"No integrations connected yet"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-[var(--ink-muted)]",children:"Connect CRMs, calendars, and telephony to consolidate portfolio reporting."})]})]})]})}function C(){let{organization:e}=(0,l.useOrganization)(),{user:t}=(0,l.useUser)(),{getToken:n}=(0,i.useAuth)(),d=(0,r.useSearchParams)(),c=d.get("orgId"),o=d.get("filter"),x=t?.publicMetadata?.kobyRole==="staff",m=c||e?.id||null,u=(0,N.isKobyInternalOrg)(m),h=x||(0,N.isKobyInternalOrg)(e?.id),p=h&&!m,[v,g]=(0,a.useState)("loading"),[f,j]=(0,a.useState)(null),[$,C]=(0,a.useState)(null),[T,_]=(0,a.useState)([]),[D,P]=(0,a.useState)(null),[O,M]=(0,a.useState)([]),[q,B]=(0,a.useState)([]),[F,E]=(0,a.useState)([]),[z,U]=(0,a.useState)([]),[K,H]=(0,a.useState)([]),[W,V]=(0,a.useState)(null),[Y,G]=(0,a.useState)(null),[Z,J]=(0,a.useState)("24h"),X=async()=>{g("loading"),j(null);try{let j=await n();if(!j)throw Error("Not authenticated");let S=async e=>{let t=await fetch(`${k}${e}`,{headers:{Authorization:`Bearer ${j}`}});if(404===t.status)return null;if(!t.ok)throw Error(`Failed to fetch ${e}: ${t.status}`);return t.json()};if(p||u)if(P(null),k)try{let e=await fetch(`${k}/portal/clients${o?`?filter=${o}`:""}`,{headers:{Authorization:`Bearer ${j}`}});if(!e.ok)throw Error(`Failed to fetch clients: ${e.status}`);let t=await e.json();_(t.clients||[])}catch(e){_([]),P(e instanceof Error?e.message:"Failed to load clients")}else _([]);if(h&&k)try{let e=await fetch(`${k}/portal/cloudflare-analytics?period=${Z}`,{headers:{Authorization:`Bearer ${j}`}});if(e.ok){let t=await e.json();t.analytics&&G(t.analytics)}}catch(e){console.error("Failed to fetch Cloudflare analytics:",e)}if(p)return void g("success");if(m){var e,t,s,a,r,l,i,d,c,x,v,b,f,N,A;let n,o,u;if(!k){C({metrics:[],engines:[],workflows:[],flows:[],flowTests:[],flowInsights:[],insights:[],qualitySignals:[],teamAccess:[],knowledge:null,events:[],integrations:[],outcomes:[],auditLogs:[],retentionPolicies:[],actionRuns:[]}),g("success");return}let[h,p,j,$,L,I,R,T,_]=await Promise.all([S(`/portal/overview?orgId=${m}`),S(`/portal/engines?orgId=${m}`),S(`/portal/insights?orgId=${m}`),S(`/portal/workflows?orgId=${m}`),S(`/portal/events?orgId=${m}`),S(`/portal/team?orgId=${m}`),S(`/portal/integrations?orgId=${m}`),S(`/portal/knowledge?orgId=${m}`),S(`/portal/flows?orgId=${m}`)]),D=[],P=[],O=[],q=[],F=[];if(k){let[e,t,s,a,r,l]=await Promise.allSettled([S(`/outcomes?orgId=${m}`),S(`/billing/usage?orgId=${m}`),S(`/audit/logs?orgId=${m}`),S(`/retention/policies?orgId=${m}`),S(`/actions/runs?orgId=${m}`),S(`/billing/overview?orgId=${m}`)]);"fulfilled"===e.status&&e.value?.outcomes&&(D=e.value.outcomes),"fulfilled"===t.status&&t.value?.records&&(P=t.value.records),"fulfilled"===s.status&&s.value?.logs&&(O=s.value.logs),"fulfilled"===a.status&&a.value?.policies&&(q=a.value.policies),"fulfilled"===r.status&&r.value?.runs&&(F=r.value.runs),"fulfilled"===l.status&&l.value?.currentPlan&&V(l.value.currentPlan.status)}if(!k){let e=new Date().toISOString();D=[{id:"sample_outcome",orgId:m,actionRunId:void 0,outcomeType:"lead_captured",label:"Sample outcome (worker disabled)",amountCents:0,currency:"USD",recordedAt:e,metadata:{}}],P=[{id:"sample_billing",orgId:m,usageType:"actions",quantity:0,unitPriceCents:0,amountCents:0,status:"pending",periodStart:e,periodEnd:e,externalInvoiceId:void 0,createdAt:e,updatedAt:e}],F=[{id:"sample_run",actionId:"sample_action",orgId:m,status:"pending",attempt:0,maxRetries:3,retryPolicy:"fixed",triggerSource:"demo",idempotencyKey:"demo",flowId:void 0,input:{},output:void 0,error:void 0,startedAt:e,completedAt:void 0,nextRetryAt:void 0,metadata:{},createdAt:e}]}let z=h||{org:null,sites:[],stats:{totalSessions:0,totalMessages:0,avgLatency:0,leadsCapture:0,appointmentsBooked:0,activeSessions:0},period:(n=new Date,(o=new Date).setDate(n.getDate()-30),{start:o.toISOString().split("T")[0],end:n.toISOString().split("T")[0]})};C((e=z,t=p,s=j,a=$,r=L,l=I,i=T,d=_,c=R?.integrations||[],x=function(e){if(!e.length)return[];let t=e.reduce((e,t)=>e+(t.amountCents||0),0);return[{id:"outcomes_count",title:"Outcomes logged",value:w(e.length),note:"Last 30 days",status:"up"},{id:"outcomes_value",title:"Captured value",value:y(t),note:"Total captured across outcomes",status:"up"}]}(D),v=O,b=q,f=F,{metrics:[{label:"Total sessions",value:w((N=e.stats).totalSessions)},{label:"Messages",value:w(N.totalMessages)},{label:"Active sessions",value:w(N.activeSessions)},{label:"Leads captured",value:w(N.leadsCapture)},{label:"Appointments booked",value:w(N.appointmentsBooked)},{label:"Avg latency",value:N.avgLatency?`${Math.round(N.avgLatency)} ms`:"--"}],engines:(t?.engines||[]).map(e=>({title:e.name,status:"active"===e.status?"Active":"paused"===e.status?"Degraded":"Down",detail:e.domain?`Domain: ${e.domain}`:"No domain configured",metric:`Sessions today: ${w(e.todaySessions)}`})),workflows:a?.workflows||[],flows:d?.flows||[],flowTests:d?.tests||[],flowInsights:d?.insights||[],insights:(s?.dailyMetrics||[]).slice(-7).map(e=>({label:e.date.slice(5),value:e.total_sessions})),qualitySignals:(s?.insights||[]).map((e,t)=>({title:"alert"===e.type?"Alert":"warning"===e.type?"Warning":"Tip",value:`#${t+1}`,note:e.message})),teamAccess:(A=l?.team||[],u={},A.forEach(e=>{let t=e.role||"Member";u[t]=(u[t]||0)+1}),Object.entries(u).map(([e,t])=>({role:e,count:t}))),knowledge:i||{sources:[],documents:[],policies:[]},events:r?.events||[],integrations:c||[],outcomes:x||[],auditLogs:v||[],retentionPolicies:b||[],actionRuns:f||[]})),M(D),B(P),E(O),U(q),H(F),g("success")}else g("success")}catch(e){console.error("Error fetching portal data:",e),j(e instanceof Error?e.message:"An unexpected error occurred"),g("error")}};return((0,a.useEffect)(()=>{t&&X()},[t,m,p,u,o,Z]),"loading"===v)?(0,s.jsx)(A,{}):"error"===v&&f?(0,s.jsx)(S,{message:f,onRetry:X}):p?(0,s.jsx)("div",{className:"max-w-6xl mx-auto pt-10",children:(0,s.jsx)(b,{clients:T,error:D})}):u&&$?(0,s.jsx)(R,{data:$,clients:T,clientsError:D,cloudflareAnalytics:Y,cfAnalyticsPeriod:Z,onCfPeriodChange:J}):$?(0,s.jsx)(I,{data:$,outcomes:O,billing:q,subscriptionStatus:W,onManageBilling:async()=>{try{let e=await n();if(!e||!k)return;let t=await fetch(`${k}/billing/portal-session`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({returnUrl:window.location.href})});if(t.ok){let{url:e}=await t.json();e&&(window.location.href=e)}}catch(e){console.error("Failed to open billing portal:",e)}}}):(0,s.jsx)(L,{})}function T(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)(A,{}),children:(0,s.jsx)(C,{})})}e.s(["default",()=>T],46631)}]);